<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/fancybox@3/dist/css/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://127.0.0.1:4000').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: true,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"default"},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: true,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="咖喱鸡扒饭">
<meta property="og:url" content="http://127.0.0.1:4000/page/3/index.html">
<meta property="og:site_name" content="咖喱鸡扒饭">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="XWookey">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://127.0.0.1:4000/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>咖喱鸡扒饭</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="咖喱鸡扒饭" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">咖喱鸡扒饭</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-斗鱼工具">

    <a href="/douyu-tool/" rel="section"><i class="fa fa-fw fa-play-circle"></i>斗鱼工具</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL1hXb29rZXk=" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/16/Java%E5%AE%9E%E4%BD%93%E6%98%A0%E5%B0%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/16/Java%E5%AE%9E%E4%BD%93%E6%98%A0%E5%B0%84/" class="post-title-link" itemprop="url">Java实体映射工具</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-16 18:36:09" itemprop="dateCreated datePublished" datetime="2020-02-16T18:36:09+08:00">2020-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>314</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2RyZWFtbHUvbWljYS9taWNhLWJlYW4tY29weQ==" title="https://www.yuque.com/dreamlu/mica/mica-bean-copy">Java Bean Copy 性能大比拼<i class="fa fa-external-link"></i></span></p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/16/Java%E5%AE%9E%E4%BD%93%E6%98%A0%E5%B0%84/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/15/NETOP%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/15/NETOP%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">NETOP部署</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 13:09:24" itemprop="dateCreated datePublished" datetime="2020-02-15T13:09:24+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-15 13:45:43" itemprop="dateModified" datetime="2020-05-15T13:45:43+08:00">2020-05-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>31k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>28 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境基础"><a href="#环境基础" class="headerlink" title="环境基础"></a>环境基础</h2><h3 id="配置虚拟机"><a href="#配置虚拟机" class="headerlink" title="配置虚拟机"></a>配置虚拟机</h3><p>由于公司上网限制需要将虚拟机模式为NAT模式</p>
<table>
<thead>
<tr>
<th>VMware中的设置</th>
<th><span style="color:blue"><code>linux</code></span>中的网卡设置</th>
</tr>
</thead>
<tbody><tr>
<td>NAT设置中的<code>子网掩码</code></td>
<td><span style="color:blue"><code>NETMASK</code></span>需要设置为 <code>子网掩码</code></td>
</tr>
<tr>
<td>虚拟机网卡的<code>MAC</code>,连接符为<code>-</code></td>
<td><span style="color:blue"><code>HWADDR</code></span>需要设置为 <code>MAC</code> ,连接符为<span style="color:blue"><code>:</code></span></td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/15/NETOP%E9%83%A8%E7%BD%B2/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/" class="post-title-link" itemprop="url">新服务器搭建Jenkins</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-15 09:08:47" itemprop="dateCreated datePublished" datetime="2020-02-15T09:08:47+08:00">2020-02-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>23k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>21 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="环境基础"><a href="#环境基础" class="headerlink" title="环境基础"></a>环境基础</h2><h3 id="配置虚拟机"><a href="#配置虚拟机" class="headerlink" title="配置虚拟机"></a>配置虚拟机</h3><p>由于公司上网限制需要将虚拟机模式为NAT模式, 一般来说当为NAT模式的网管为 192.168.xx.2</p>
<table>
<thead>
<tr>
<th>VMware中的设置</th>
<th><span style="color:blue"><code>linux</code></span>中的网卡设置</th>
</tr>
</thead>
<tbody><tr>
<td>DHCP设置中<code>起始IP地址</code>，<code>结束IP地址</code></td>
<td><span style="color:blue"><code>IPADDR</code></span>需要设置在 <code>起始IP地址</code>，<code>结束IP地址</code>之间</td>
</tr>
<tr>
<td>NAT设置中的<code>网关IP</code></td>
<td><span style="color:blue"><code>GATEWAY</code></span>,<span style="color:blue"><code>DNS1</code></span> 设置为<code>网关IP</code></td>
</tr>
<tr>
<td>NAT设置中的<code>子网掩码</code></td>
<td><span style="color:blue"><code>NETMASK</code></span>需要设置为 <code>子网掩码</code></td>
</tr>
<tr>
<td>虚拟机网卡的<code>MAC</code>,连接符为<code>-</code></td>
<td><span style="color:blue"><code>HWADDR</code></span>需要设置为 <code>MAC</code> ,连接符为<span style="color:blue"><code>:</code></span></td>
</tr>
</tbody></table>
<h4 id="虚拟网络编辑器"><a href="#虚拟网络编辑器" class="headerlink" title="虚拟网络编辑器"></a>虚拟网络编辑器</h4><p>虚拟机的NAT模式可以在 “编辑” -&gt; “虚拟机网络编辑器”<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215125030058.png" alt="image-20200215125030058"></p>
<h4 id="NAT设置"><a href="#NAT设置" class="headerlink" title="NAT设置"></a>NAT设置</h4><p>这里决定了linux的<span style="color:blue"><code>GATEWAY</code></span>,<span style="color:blue"><code>DNS1</code></span><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215124821110.png" alt="image-20200215124821110"></p>
<h4 id="DHCP设置"><a href="#DHCP设置" class="headerlink" title="DHCP设置"></a>DHCP设置</h4><p>这里决定了linux的<span style="color:blue"><code>IPADDR</code></span><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215125004889.png" alt="image-20200215125004889"></p>
<h4 id="虚拟机网卡设置"><a href="#虚拟机网卡设置" class="headerlink" title="虚拟机网卡设置"></a>虚拟机网卡设置</h4><p>这里决定了linux的<span style="color:blue"><code>HWADDR</code></span><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215130649654.png" alt="image-20200215130649654"></p>
<h3 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h3><p>在启动<code>grub</code>菜单，选择编辑选项启动<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/1032090-20161130233025193-1691299631.png" alt="img"></p>
<p>按键盘<code>e</code>键，来进入编辑界面<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/1032090-20161130233127037-710798124.png" alt="img"></p>
<p>找到Linux 16的那一行，将<code>ro</code>改为<code>rw init=/sysroot/bin/sh</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/1032090-20161130233144537-1008782378.png" alt="img"></p>
<p>现在按下<code>Control+x</code>，使用单用户模式启动<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/1032090-20161130233155490-57701682.png" alt="img"><br>现在，可以使用下面的命令访问系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot /sysroot</span><br></pre></td></tr></table></figure>
<p>重置密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd root</span><br></pre></td></tr></table></figure>
<p>更新系统信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch /.autorelabel</span><br></pre></td></tr></table></figure>
<p>退出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<p>重启你的系统 reboot</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure>
<h3 id="配置IP"><a href="#配置IP" class="headerlink" title="配置IP"></a>配置IP</h3><p>查看网卡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd &#x2F;etc&#x2F;sysconfig&#x2F;network-scripts&#x2F;</span><br><span class="line">[root@localhost network-scripts]# ls</span><br><span class="line">ifcfg-ens33  ifdown-eth   ifdown-post    ifdown-Team      ifup-aliases  ifup-ipv6   ifup-post    ifup-Team      init.ipv6-global</span><br><span class="line">ifcfg-lo     ifdown-ippp  ifdown-ppp     ifdown-TeamPort  ifup-bnep     ifup-isdn   ifup-ppp     ifup-TeamPort  network-functions</span><br><span class="line">ifdown       ifdown-ipv6  ifdown-routes  ifdown-tunnel    ifup-eth      ifup-plip   ifup-routes  ifup-tunnel    network-functions-ipv6</span><br><span class="line">ifdown-bnep  ifdown-isdn  ifdown-sit     ifup             ifup-ippp     ifup-plusb  ifup-sit     ifup-wireless</span><br><span class="line">[root@localhost network-scripts]# </span><br></pre></td></tr></table></figure>
<p>编辑网卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]<span class="comment"># vi ifcfg-ens33</span></span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.235.228</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.235.2</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">PEERDNS=yes</span><br><span class="line">PEERROUTES=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_PEERDNS=yes</span><br><span class="line">IPV6_PEERROUTES=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=ddc851a6-9f17-46fa-b008-fffec48d00a0</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">HWADDR=18:66:DA:F2:F4:28</span><br><span class="line">DNS1=192.168.235.2</span><br></pre></td></tr></table></figure>
<p>重启网卡并查看效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]# systemctl restart network</span><br><span class="line">[root@localhost network-scripts]# curl www.baidu.com</span><br></pre></td></tr></table></figure>

<h3 id="YUM"><a href="#YUM" class="headerlink" title="YUM"></a>YUM</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]# mv &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo.backup</span><br><span class="line">[root@localhost network-scripts]# curl -o &#x2F;etc&#x2F;yum.repos.d&#x2F;CentOS-Base.repo http:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;repo&#x2F;Centos-7.repo</span><br><span class="line">[root@localhost network-scripts]# yum makecache</span><br><span class="line">[root@localhost network-scripts]# yum -y install wget</span><br><span class="line">[root@localhost network-scripts]# yum -y install vim</span><br><span class="line">[root@localhost network-scripts]# yum -y install net-tools</span><br><span class="line">[root@localhost network-scripts]# yum -y install iptables-services</span><br></pre></td></tr></table></figure>

<h3 id="selinux"><a href="#selinux" class="headerlink" title="selinux"></a>selinux</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]# vim &#x2F;etc&#x2F;selinux&#x2F;config </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># This file controls the state of SELinux on the system.</span><br><span class="line"># SELINUX&#x3D; can take one of these three values:</span><br><span class="line">#     enforcing - SELinux security policy is enforced.</span><br><span class="line">#     permissive - SELinux prints warnings instead of enforcing.</span><br><span class="line">#     disabled - No SELinux policy is loaded.</span><br><span class="line">SELINUX&#x3D;disabled</span><br><span class="line"># SELINUXTYPE&#x3D; can take one of three values:</span><br><span class="line">#     targeted - Targeted processes are protected,</span><br><span class="line">#     minimum - Modification of targeted policy. Only selected processes are protected. </span><br><span class="line">#     mls - Multi Level Security protection.</span><br><span class="line">SELINUXTYPE&#x3D;targeted</span><br></pre></td></tr></table></figure>
<h3 id="iptable"><a href="#iptable" class="headerlink" title="iptable"></a>iptable</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost network-scripts]# iptables -F</span><br><span class="line">[root@localhost network-scripts]# service iptables save</span><br></pre></td></tr></table></figure>
<h3 id="firewalld-service"><a href="#firewalld-service" class="headerlink" title="firewalld.service"></a>firewalld.service</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure>
<h2 id="安装git"><a href="#安装git" class="headerlink" title="安装git"></a>安装git</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install git</span><br></pre></td></tr></table></figure>

<h2 id="安装java"><a href="#安装java" class="headerlink" title="安装java"></a>安装java</h2><h3 id="下载并安装JAVA"><a href="#下载并安装JAVA" class="headerlink" title="下载并安装JAVA"></a>下载并安装JAVA</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/app</span><br><span class="line">mkdir -p /opt/package/</span><br><span class="line"><span class="built_in">cd</span> /opt/app</span><br><span class="line">wget -P /opt/package https://repo.huaweicloud.com/java/jdk/8u202-b08/jdk-8u202-linux-x64.tar.gz</span><br><span class="line">tar -zxvf /opt/package/jdk-8u202-linux-x64.tar.gz -C /opt/app</span><br><span class="line">ln -s jdk1.8.0_202 jdk</span><br></pre></td></tr></table></figure>

<h3 id="修改profile"><a href="#修改profile" class="headerlink" title="修改profile"></a>修改profile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后3行插入</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/app/jdk</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h3 id="刷新配置并验证"><a href="#刷新配置并验证" class="headerlink" title="刷新配置并验证"></a>刷新配置并验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">javac -version</span><br></pre></td></tr></table></figure>

<h2 id="安装MAVEN"><a href="#安装MAVEN" class="headerlink" title="安装MAVEN"></a>安装MAVEN</h2><h3 id="下载解压maven"><a href="#下载解压maven" class="headerlink" title="下载解压maven"></a>下载解压maven</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/app</span><br><span class="line">mkdir -p /opt/package/</span><br><span class="line"><span class="built_in">cd</span> /opt/app</span><br><span class="line">wget -P /opt/package https://mirrors.huaweicloud.com/apache/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz</span><br><span class="line">tar -zxvf /opt/package/apache-maven-3.6.3-bin.tar.gz -C /opt/app</span><br><span class="line">ln -s apache-maven-3.6.3 maven</span><br></pre></td></tr></table></figure>

<h3 id="修改profile-1"><a href="#修改profile-1" class="headerlink" title="修改profile"></a>修改profile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后3行插入</span></span><br><span class="line"><span class="built_in">export</span> MAVEN_HOME=/opt/app/maven</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$MAVEN_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h3 id="刷新配置并验证-1"><a href="#刷新配置并验证-1" class="headerlink" title="刷新配置并验证"></a>刷新配置并验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">mvn -v</span><br></pre></td></tr></table></figure>

<h3 id="设置配置文件"><a href="#设置配置文件" class="headerlink" title="设置配置文件"></a>设置配置文件</h3><p>创建仓库目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/app/data/repository</span><br></pre></td></tr></table></figure>
<p>编辑配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/app/maven/conf/settings.xml</span><br></pre></td></tr></table></figure>

<p>完整配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment">or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment">distributed with this work for additional information</span></span><br><span class="line"><span class="comment">regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment">to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment">&quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment">with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment">software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment">&quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment">KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment">specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment">under the License.</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> | This is the configuration file for Maven. It can be specified at two levels:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  1. User Level. This settings.xml file provides configuration for a single user,</span></span><br><span class="line"><span class="comment"> |                 and is normally provided in $&#123;user.home&#125;/.m2/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -s /path/to/user/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |  2. Global Level. This settings.xml file provides configuration for all Maven</span></span><br><span class="line"><span class="comment"> |                 users on a machine (assuming they&#x27;re all using the same Maven</span></span><br><span class="line"><span class="comment"> |                 installation). It&#x27;s normally provided in</span></span><br><span class="line"><span class="comment"> |                 $&#123;maven.conf&#125;/settings.xml.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 <span class="doctag">NOTE:</span> This location can be overridden with the CLI option:</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |                 -gs /path/to/global/settings.xml</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> | The sections in this sample file are intended to give you a running start at</span></span><br><span class="line"><span class="comment"> | getting the most out of your Maven installation. Where appropriate, the default</span></span><br><span class="line"><span class="comment"> | values (values used when the setting is not specified) are provided.</span></span><br><span class="line"><span class="comment"> |</span></span><br><span class="line"><span class="comment"> |--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- localRepository</span></span><br><span class="line"><span class="comment">   | The path to the local repository maven will use to store artifacts.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: $&#123;user.home&#125;/.m2/repository</span></span><br><span class="line"><span class="comment">  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>/opt/app/data/repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- interactiveMode</span></span><br><span class="line"><span class="comment">   | This will determine whether maven prompts you when it needs input. If set to false,</span></span><br><span class="line"><span class="comment">   | maven will use a sensible default value, perhaps based on some other setting, for</span></span><br><span class="line"><span class="comment">   | the parameter in question.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: true</span></span><br><span class="line"><span class="comment">  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- offline</span></span><br><span class="line"><span class="comment">   | Determines whether maven should attempt to connect to the network when executing a build.</span></span><br><span class="line"><span class="comment">   | This will have an effect on artifact downloads, artifact deployment, and others.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | Default: false</span></span><br><span class="line"><span class="comment">  &lt;offline&gt;false&lt;/offline&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- pluginGroups</span></span><br><span class="line"><span class="comment">   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.</span></span><br><span class="line"><span class="comment">   | when invoking a command line like &quot;mvn prefix:goal&quot;. Maven will automatically add the group identifiers</span></span><br><span class="line"><span class="comment">   | &quot;org.apache.maven.plugins&quot; and &quot;org.codehaus.mojo&quot; if these are not already contained in the list.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- pluginGroup</span></span><br><span class="line"><span class="comment">     | Specifies a further group identifier to use for plugin lookup.</span></span><br><span class="line"><span class="comment">    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginGroups</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- proxies</span></span><br><span class="line"><span class="comment">   | This is a list of proxies which can be used on this machine to connect to the network.</span></span><br><span class="line"><span class="comment">   | Unless otherwise specified (by system property or command-line switch), the first proxy</span></span><br><span class="line"><span class="comment">   | specification in this list marked as active will be used.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">proxies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- proxy</span></span><br><span class="line"><span class="comment">     | Specification for one proxy, to be used in connecting to the network.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;proxy&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;optional&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;active&gt;true&lt;/active&gt;</span></span><br><span class="line"><span class="comment">      &lt;protocol&gt;http&lt;/protocol&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;proxyuser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;proxypass&lt;/password&gt;</span></span><br><span class="line"><span class="comment">      &lt;host&gt;proxy.host.net&lt;/host&gt;</span></span><br><span class="line"><span class="comment">      &lt;port&gt;80&lt;/port&gt;</span></span><br><span class="line"><span class="comment">      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;</span></span><br><span class="line"><span class="comment">    &lt;/proxy&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- servers</span></span><br><span class="line"><span class="comment">   | This is a list of authentication profiles, keyed by the server-id used within the system.</span></span><br><span class="line"><span class="comment">   | Authentication profiles can be used whenever maven must make a connection to a remote server.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- server</span></span><br><span class="line"><span class="comment">     | Specifies the authentication information to use when connecting to a particular server, identified by</span></span><br><span class="line"><span class="comment">     | a unique name within the system (referred to by the &#x27;id&#x27; attribute below).</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> You should either specify username/password OR privateKey/passphrase, since these pairings are</span></span><br><span class="line"><span class="comment">     |       used together.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;deploymentRepo&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;username&gt;repouser&lt;/username&gt;</span></span><br><span class="line"><span class="comment">      &lt;password&gt;repopwd&lt;/password&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Another sample, using keys to authenticate.</span></span><br><span class="line"><span class="comment">    &lt;server&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;siteServer&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;</span></span><br><span class="line"><span class="comment">      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;</span></span><br><span class="line"><span class="comment">    &lt;/server&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- mirrors</span></span><br><span class="line"><span class="comment">   | This is a list of mirrors to be used in downloading artifacts from remote repositories.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | It works like this: a POM may declare a repository to use in resolving certain artifacts.</span></span><br><span class="line"><span class="comment">   | However, this repository may have problems with heavy traffic at times, so people have mirrored</span></span><br><span class="line"><span class="comment">   | it to several places.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | That repository definition will have a unique id, so we can create a mirror reference for that</span></span><br><span class="line"><span class="comment">   | repository, to be used as an alternate download site. The mirror site will be the preferred</span></span><br><span class="line"><span class="comment">   | server for that repository.</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>aliyunmaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>阿里云公共仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://maven.aliyun.com/repository/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>huaweicloud<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>华为云公共仓库<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.huaweicloud.com/repository/maven/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>repo2<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo2.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">mirror</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>nuiton<span class="tag">&lt;/<span class="name">id</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>nuiton<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.nuiton.org/release/<span class="tag">&lt;/<span class="name">url</span>&gt;</span>  </span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>          </span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span>&gt;</span>boundlessgeo<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>*<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo.boundlessgeo.com/main/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">&lt;!-- mirror</span></span><br><span class="line"><span class="comment">     | Specifies a repository mirror site to use instead of a given repository. The repository that</span></span><br><span class="line"><span class="comment">     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used</span></span><br><span class="line"><span class="comment">     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;mirror&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;mirrorId&lt;/id&gt;</span></span><br><span class="line"><span class="comment">      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;</span></span><br><span class="line"><span class="comment">      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;</span></span><br><span class="line"><span class="comment">      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;</span></span><br><span class="line"><span class="comment">    &lt;/mirror&gt;</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- profiles</span></span><br><span class="line"><span class="comment">   | This is a list of profiles which can be activated in a variety of ways, and which can modify</span></span><br><span class="line"><span class="comment">   | the build process. Profiles provided in the settings.xml are intended to provide local machine-</span></span><br><span class="line"><span class="comment">   | specific paths and repository locations which allow the build to work in the local environment.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | For example, if you have an integration testing plugin - like cactus - that needs to know where</span></span><br><span class="line"><span class="comment">   | your Tomcat instance is installed, you can provide a variable here such that the variable is</span></span><br><span class="line"><span class="comment">   | dereferenced during the build process to configure the cactus plugin.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles</span></span><br><span class="line"><span class="comment">   | section of this document (settings.xml) - will be discussed later. Another way essentially</span></span><br><span class="line"><span class="comment">   | relies on the detection of a system property, either matching a particular value for the property,</span></span><br><span class="line"><span class="comment">   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a</span></span><br><span class="line"><span class="comment">   | value of &#x27;1.4&#x27; might activate a profile when the build is executed on a JDK version of &#x27;1.4.2_07&#x27;.</span></span><br><span class="line"><span class="comment">   | Finally, the list of active profiles can be specified directly from the command line.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   | <span class="doctag">NOTE:</span> For profiles defined in the settings.xml, you are restricted to specifying only artifact</span></span><br><span class="line"><span class="comment">   |       repositories, plugin repositories, and free-form properties to be used as configuration</span></span><br><span class="line"><span class="comment">   |       variables for plugins in the POM.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">   |--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- profile</span></span><br><span class="line"><span class="comment">     | Specifies a set of introductions to the build process, to be activated using one or more of the</span></span><br><span class="line"><span class="comment">     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;</span></span><br><span class="line"><span class="comment">     | or the command line, profiles have to have an ID that is unique.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | An encouraged best practice for profile identification is to use a consistent naming convention</span></span><br><span class="line"><span class="comment">     | for profiles, such as &#x27;env-dev&#x27;, &#x27;env-test&#x27;, &#x27;env-production&#x27;, &#x27;user-jdcasey&#x27;, &#x27;user-brett&#x27;, etc.</span></span><br><span class="line"><span class="comment">     | This will make it more intuitive to understand what the set of introduced profiles is attempting</span></span><br><span class="line"><span class="comment">     | to accomplish, particularly when you only have a list of profile id&#x27;s for debug.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;jdk-1.4&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;jdk&gt;1.4&lt;/jdk&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;repositories&gt;</span></span><br><span class="line"><span class="comment">        &lt;repository&gt;</span></span><br><span class="line"><span class="comment">          &lt;id&gt;jdk14&lt;/id&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;</span></span><br><span class="line"><span class="comment">          &lt;layout&gt;default&lt;/layout&gt;</span></span><br><span class="line"><span class="comment">          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;</span></span><br><span class="line"><span class="comment">        &lt;/repository&gt;</span></span><br><span class="line"><span class="comment">      &lt;/repositories&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">     | Here is another profile, activated by the system property &#x27;target-env&#x27; with a value of &#x27;dev&#x27;,</span></span><br><span class="line"><span class="comment">     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration</span></span><br><span class="line"><span class="comment">     | might hypothetically look like:</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     | &lt;plugin&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     |   &lt;configuration&gt;</span></span><br><span class="line"><span class="comment">     |     &lt;tomcatLocation&gt;$&#123;tomcatPath&#125;&lt;/tomcatLocation&gt;</span></span><br><span class="line"><span class="comment">     |   &lt;/configuration&gt;</span></span><br><span class="line"><span class="comment">     | &lt;/plugin&gt;</span></span><br><span class="line"><span class="comment">     | ...</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">     | <span class="doctag">NOTE:</span> If you just wanted to inject this configuration whenever someone set &#x27;target-env&#x27; to</span></span><br><span class="line"><span class="comment">     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.</span></span><br><span class="line"><span class="comment">     |</span></span><br><span class="line"><span class="comment">    &lt;profile&gt;</span></span><br><span class="line"><span class="comment">      &lt;id&gt;env-dev&lt;/id&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;activation&gt;</span></span><br><span class="line"><span class="comment">        &lt;property&gt;</span></span><br><span class="line"><span class="comment">          &lt;name&gt;target-env&lt;/name&gt;</span></span><br><span class="line"><span class="comment">          &lt;value&gt;dev&lt;/value&gt;</span></span><br><span class="line"><span class="comment">        &lt;/property&gt;</span></span><br><span class="line"><span class="comment">      &lt;/activation&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      &lt;properties&gt;</span></span><br><span class="line"><span class="comment">        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;</span></span><br><span class="line"><span class="comment">      &lt;/properties&gt;</span></span><br><span class="line"><span class="comment">    &lt;/profile&gt;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- activeProfiles</span></span><br><span class="line"><span class="comment">   | List of profiles that are active for all builds.</span></span><br><span class="line"><span class="comment">   |</span></span><br><span class="line"><span class="comment">  &lt;activeProfiles&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;</span></span><br><span class="line"><span class="comment">  &lt;/activeProfiles&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="安装NODEJS"><a href="#安装NODEJS" class="headerlink" title="安装NODEJS"></a>安装NODEJS</h2><h3 id="下载解压NODEJS"><a href="#下载解压NODEJS" class="headerlink" title="下载解压NODEJS"></a>下载解压NODEJS</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/app</span><br><span class="line">mkdir -p /opt/package/</span><br><span class="line"><span class="built_in">cd</span> /opt/app</span><br><span class="line">wget -P /opt/package https://mirrors.tuna.tsinghua.edu.cn/nodejs-release/v12.15.0/node-v12.15.0-linux-x64.tar.gz</span><br><span class="line">tar -zxvf /opt/package/node-v12.15.0-linux-x64.tar.gz -C /opt/app</span><br><span class="line">ln -s node-v12.15.0-linux-x64 node</span><br></pre></td></tr></table></figure>

<h3 id="修改profile-2"><a href="#修改profile-2" class="headerlink" title="修改profile"></a>修改profile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后3行插入</span></span><br><span class="line"><span class="built_in">export</span> NODE_HOME=/opt/app/node</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$NODE_HOME</span>/bin:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<h3 id="刷新配置并验证-2"><a href="#刷新配置并验证-2" class="headerlink" title="刷新配置并验证"></a>刷新配置并验证</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br></pre></td></tr></table></figure>
<h3 id="安装cnpm-yarn"><a href="#安装cnpm-yarn" class="headerlink" title="安装cnpm,yarn"></a>安装cnpm,yarn</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line">cnpm install -g yarn</span><br><span class="line"></span><br><span class="line">cnpm -v</span><br><span class="line">yarn -v</span><br></pre></td></tr></table></figure>


<h2 id="安装jenkins"><a href="#安装jenkins" class="headerlink" title="安装jenkins"></a>安装jenkins</h2><blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vbG92ZXlvdXlvdTYxNi9wLzg3MTQ1NDQuaHRtbA==" title="https://www.cnblogs.com/loveyouyou616/p/8714544.html">https://www.cnblogs.com/loveyouyou616/p/8714544.html<i class="fa fa-external-link"></i></span><br><code>jenkins</code>以<code>rpm</code>安装方式的目录约定</p>
</blockquote>
<table>
<thead>
<tr>
<th>路径</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>/var/log/jenkins</code></td>
<td><code>jenkins</code>日志目录</td>
</tr>
<tr>
<td><code>/var/lib/jenkins</code></td>
<td><code>war</code>包解压目录</td>
</tr>
<tr>
<td><code>/var/cache/jenkins</code></td>
<td>缓存目录</td>
</tr>
<tr>
<td><code>/etc/sysconfig/jenkins</code></td>
<td><code>jenkins</code>参数配置文件</td>
</tr>
<tr>
<td><code>/etc/yum.repos.d/jenkins.repo</code></td>
<td><code>jenkins</code>的<code>rpm</code>仓库配置</td>
</tr>
</tbody></table>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/package/</span><br><span class="line"><span class="built_in">cd</span> /opt/package</span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.204.2-1.1.noarch.rpm</span><br><span class="line">rpm -ivh jenkins-2.204.2-1.1.noarch.rpm  -C /opt/app</span><br></pre></td></tr></table></figure>

<h3 id="修改端口"><a href="#修改端口" class="headerlink" title="修改端口"></a>修改端口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim &#x2F;etc&#x2F;sysconfig&#x2F;jenkins</span><br><span class="line"></span><br><span class="line">#修改端口号</span><br><span class="line">JENKINS_PORT&#x3D;&quot;8083&quot;</span><br><span class="line">#修改用户权限</span><br><span class="line">JENKINS_USER&#x3D;&quot;root&quot;</span><br></pre></td></tr></table></figure>
<h3 id="启动jenkins"><a href="#启动jenkins" class="headerlink" title="启动jenkins"></a>启动jenkins</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service jenkins start</span><br></pre></td></tr></table></figure>

<h2 id="NGINX"><a href="#NGINX" class="headerlink" title="NGINX"></a>NGINX</h2><blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vYm9vbnlhL3AvNzkwNzk5OS5odG1s" title="https://www.cnblogs.com/boonya/p/7907999.html">https://www.cnblogs.com/boonya/p/7907999.html<i class="fa fa-external-link"></i></span></p>
</blockquote>
<h3 id="下载解压nginx"><a href="#下载解压nginx" class="headerlink" title="下载解压nginx"></a>下载解压nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础软件</span></span><br><span class="line">yum install gcc-c++</span><br><span class="line">yum install -y pcre pcre-devel</span><br><span class="line">yum install -y zlib zlib-devel</span><br><span class="line">yum install -y openssl openssl-devel</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/package/</span><br><span class="line">wget -P /opt/package https://mirrors.huaweicloud.com/nginx/nginx-1.17.tar.gz</span><br><span class="line">tar -zxvf /opt/package/nginx-1.17.tar.gz  -C /opt/app</span><br></pre></td></tr></table></figure>

<h3 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="built_in">local</span>/nginx --with-http_ssl_module</span><br></pre></td></tr></table></figure>

<h3 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h3 id="查找安装路径"><a href="#查找安装路径" class="headerlink" title="查找安装路径"></a>查找安装路径</h3><p>环境变量在安装时已经自动配置完成了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whereis nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># nginx: /usr/local/nginx</span></span><br></pre></td></tr></table></figure>

<h3 id="启动、停止、重启nginx"><a href="#启动、停止、重启nginx" class="headerlink" title="启动、停止、重启nginx"></a>启动、停止、重启nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># cd &#x2F;usr&#x2F;local&#x2F;nginx</span><br><span class="line">.&#x2F;nginx </span><br><span class="line">.&#x2F;nginx -s stop #此方式相当于先查出nginx进程id再使用kill命令强制杀掉进程。</span><br><span class="line">.&#x2F;nginx -s quit # 此方式停止步骤是待nginx进程处理任务完毕进行停止。</span><br><span class="line">.&#x2F;nginx -s reload</span><br><span class="line">.&#x2F;nginx -s quit &amp;&amp; .&#x2F;nginx #重启</span><br></pre></td></tr></table></figure>

<h3 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br><span class="line"><span class="comment"># 增加一行 </span></span><br><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>
<p>设置权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 755 rc.local</span><br></pre></td></tr></table></figure>
<h2 id="安装Redis"><a href="#安装Redis" class="headerlink" title="安装Redis"></a>安装Redis</h2><h3 id="下载解压Redis"><a href="#下载解压Redis" class="headerlink" title="下载解压Redis"></a>下载解压Redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基础软件</span></span><br><span class="line">yum install -y gcc</span><br><span class="line"></span><br><span class="line">mkdir -p /opt/package/</span><br><span class="line">wget -P /opt/package https://mirrors.huaweicloud.com/redis/redis-5.0.7.tar.gz</span><br><span class="line">tar -zxvf /opt/package/redis-5.0.7.tar.gz  -C /opt/app</span><br><span class="line">ln -s redis-5.0.7 redis</span><br></pre></td></tr></table></figure>

<h3 id="编译安装-1"><a href="#编译安装-1" class="headerlink" title="编译安装"></a>编译安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> redis</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure>

<h3 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#daemonize no 改为 daemonize yes</span></span><br><span class="line">daemonize yes</span><br><span class="line"></span><br><span class="line"><span class="comment">#注释 bind 127.0.0.1</span></span><br><span class="line"><span class="comment">#bind 127.0.0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># protected-mode yes 改为 protected-mode no</span></span><br><span class="line">protected-mode yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码(非必须)</span></span><br><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>
<h3 id="启动redis"><a href="#启动redis" class="headerlink" title="启动redis"></a>启动redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/app/redis/src/redis-server /opt/app/redis/redis.conf</span><br></pre></td></tr></table></figure>

<h3 id="关闭redis"><a href="#关闭redis" class="headerlink" title="关闭redis"></a>关闭redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/app/redis/src/redis-cli shutdown</span><br></pre></td></tr></table></figure>
<p>当设置密码后关闭方法<code>/opt/app/redis/src/redis-cli -a [password]</code>按下回车后<code>shutdown</code></p>
<p>强制杀死</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis | awk ‘&#123;<span class="built_in">print</span> <span class="variable">$2</span>&#125;’ | xargs <span class="built_in">kill</span> -9</span><br></pre></td></tr></table></figure>



<h2 id="配置jenkins插件转发"><a href="#配置jenkins插件转发" class="headerlink" title="配置jenkins插件转发"></a>配置jenkins插件转发</h2><blockquote>
<p>此链接使用方法已经过旧了，本文已更新<br><span class="exturl" data-url="aHR0cHM6Ly9teS5vc2NoaW5hLm5ldC9WQVNLUy9ibG9nLzMxMDYzMTQ=" title="https://my.oschina.net/VASKS/blog/3106314">https://my.oschina.net/VASKS/blog/3106314<i class="fa fa-external-link"></i></span></p>
</blockquote>
<h3 id="修改远程插件地址"><a href="#修改远程插件地址" class="headerlink" title="修改远程插件地址"></a>修改远程插件地址</h3><p>把 <code>http://updates.jenkins-ci.org/update-center.json</code>改成<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim /var/lib/jenkins/hudson.model.UpdateCenter.xml</span><br><span class="line"></span><br><span class="line">&lt;?xml version=<span class="string">&#x27;1.1&#x27;</span> encoding=<span class="string">&#x27;UTF-8&#x27;</span>?&gt;</span><br><span class="line">&lt;sites&gt;</span><br><span class="line">  &lt;site&gt;</span><br><span class="line">    &lt;id&gt;default&lt;/id&gt;</span><br><span class="line">    &lt;url&gt;https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json&lt;/url&gt;</span><br><span class="line">  &lt;/site&gt;</span><br><span class="line">&lt;/sites&gt;</span><br></pre></td></tr></table></figure>
<h3 id="修改host文件"><a href="#修改host文件" class="headerlink" title="修改host文件"></a>修改host文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line">127.0.0.1 updates.jenkins-ci.org</span><br></pre></td></tr></table></figure>
<h3 id="修改nginx配置文件"><a href="#修改nginx配置文件" class="headerlink" title="修改nginx配置文件"></a>修改nginx配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure>

<p>修改核心配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name updates.jenkins-ci.org;</span><br><span class="line"></span><br><span class="line">    location /download/ &#123;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_pass https://mirrors.tuna.tsinghua.edu.cn/jenkins/;</span><br><span class="line">        proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_set_header Accept-Encoding &quot;&quot;;</span><br><span class="line">        #proxy_set_header User-Agent &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.49 Safari/537.36&quot;;</span><br><span class="line">        proxy_set_header Accept-Language &quot;zh-CN&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">    #error_page   404   /404.html;</span><br><span class="line"></span><br><span class="line">    location ~ /\.</span><br><span class="line">    &#123;   </span><br><span class="line">        deny all;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log  /usr/local/nginx/logs/mirror.access.log;</span><br><span class="line">    error_log   /usr/local/nginx/logs/mirror.error.log;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>完整配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#user  nobody;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">#pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    #log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;</span><br><span class="line">    #                  &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;</span><br><span class="line">    #                  &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    #access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    server&#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name updates.jenkins-ci.org;</span><br><span class="line"></span><br><span class="line">        location /download/ &#123;</span><br><span class="line">            proxy_redirect off;</span><br><span class="line">            proxy_pass https://mirrors.tuna.tsinghua.edu.cn/jenkins/;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_set_header Accept-Encoding &quot;&quot;;</span><br><span class="line">            #proxy_set_header User-Agent &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.49 Safari/537.36&quot;;</span><br><span class="line">            proxy_set_header Accept-Language &quot;zh-CN&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        index index.html index.htm index.php;</span><br><span class="line"></span><br><span class="line">        #error_page   404   /404.html;</span><br><span class="line"></span><br><span class="line">        location ~ /\.</span><br><span class="line">        &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        access_log  /usr/local/nginx/logs/mirror.access.log;</span><br><span class="line">        error_log   /usr/local/nginx/logs/mirror.error.log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       8000;</span><br><span class="line">    #    listen       somename:8080;</span><br><span class="line">    #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # HTTPS server</span><br><span class="line">    #</span><br><span class="line">    #server &#123;</span><br><span class="line">    #    listen       443 ssl;</span><br><span class="line">    #    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    #    ssl_certificate      cert.pem;</span><br><span class="line">    #    ssl_certificate_key  cert.key;</span><br><span class="line"></span><br><span class="line">    #    ssl_session_cache    shared:SSL:1m;</span><br><span class="line">    #    ssl_session_timeout  5m;</span><br><span class="line"></span><br><span class="line">    #    ssl_ciphers  HIGH:!aNULL:!MD5;</span><br><span class="line">    #    ssl_prefer_server_ciphers  on;</span><br><span class="line"></span><br><span class="line">    #    location / &#123;</span><br><span class="line">    #        root   html;</span><br><span class="line">    #        index  index.html index.htm;</span><br><span class="line">    #    &#125;</span><br><span class="line">    #&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="重启jenkins，nginx"><a href="#重启jenkins，nginx" class="headerlink" title="重启jenkins，nginx"></a>重启jenkins，nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart jenkins</span><br><span class="line">./nginx -s quit &amp;&amp; ./nginx</span><br></pre></td></tr></table></figure>


<h2 id="JENKINS配置"><a href="#JENKINS配置" class="headerlink" title="JENKINS配置"></a>JENKINS配置</h2><h3 id="启动以及基础配置"><a href="#启动以及基础配置" class="headerlink" title="启动以及基础配置"></a>启动以及基础配置</h3><p>首次进入会要求输入初始密码如下图，<br>初始密码在：<code>/var/lib/jenkins/secrets/initialAdminPassword</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/463776-20180404082707338-423425522.png" alt="img"></p>
<h3 id="安装默认插件"><a href="#安装默认插件" class="headerlink" title="安装默认插件"></a>安装默认插件</h3><p>选择“Install suggested plugins”安装默认的插件，下面Jenkins就会自己去下载相关的插件进行安装。<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/463776-20180404082737817-954357781.png" alt="img"><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/463776-20180404082804576-535120660.png" alt="img"></p>
<h3 id="设置超级管理员账号"><a href="#设置超级管理员账号" class="headerlink" title="设置超级管理员账号"></a>设置超级管理员账号</h3><p>初次进入后可能会设置用户名,密码。<br>这里用户名设置为<code>admin</code><br>这里密码设置为<code>admin</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/463776-20180404082758228-1857220561.png" alt="img"></p>
<h3 id="安装额外插件"><a href="#安装额外插件" class="headerlink" title="安装额外插件"></a>安装额外插件</h3><p><code>系统管理 </code>-&gt; <code>插件管理</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215162318535.png" alt="image-20200215162318535"><br>分别安装</p>
<ul>
<li><code>GitLab Plugin</code></li>
<li><code>GitLab Hook Plugin</code></li>
<li><code>NodeJS Plugin</code></li>
<li><code>Maven Integration plugin</code></li>
<li><code>Git parameter</code></li>
<li><code>Publish Over SSH</code></li>
<li><code>Python</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215164130755.png" alt="image-20200215164130755"><br>等待重启完成即可<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215164647114.png" alt="image-20200215164647114"></li>
</ul>
<h3 id="全局工具配置"><a href="#全局工具配置" class="headerlink" title="全局工具配置"></a>全局工具配置</h3><p><code>系统管理</code> -&gt; <code>全局工具配置</code><br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215165244622.png" alt="image-20200215165244622"></p>
<h4 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h4><p>由于<code>git</code>已经安装，全部默认<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215165510092.png" alt="image-20200215165510092"></p>
<h4 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h4><p>指向<code>$MAVEN_HOME</code>即可<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215165529058.png" alt="image-20200215165529058"></p>
<h4 id="NodeJS"><a href="#NodeJS" class="headerlink" title="NodeJS"></a>NodeJS</h4><p>指向<code>$NODE_HOME</code>即可<br><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/image-20200215165550706.png" alt="image-20200215165550706"></p>
<p>配置完成后点击保存按钮</p>
<h2 id="JENKINS部署"><a href="#JENKINS部署" class="headerlink" title="JENKINS部署"></a>JENKINS部署</h2><h3 id="JENKINS部署SpringCloud项目"><a href="#JENKINS部署SpringCloud项目" class="headerlink" title="JENKINS部署SpringCloud项目"></a>JENKINS部署SpringCloud项目</h3><p><code>新建任务</code> -&gt; <code>构建一个maven项目</code></p>
<h4 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h4><p><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/Jenkins_SpringCloud.png" alt="image-20200215165550706"></p>
<h4 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h4><p>maven跳过测试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clean install -Dmaven.test.skip=<span class="literal">true</span> -Ptest</span><br></pre></td></tr></table></figure>

<h4 id="Pre-Steps"><a href="#Pre-Steps" class="headerlink" title="Pre Steps"></a>Pre Steps</h4><p>关闭已经启动项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pid=`ps -ef | grep -n <span class="string">&#x27;netop-.*\/target\/netop-.*\.jar&#x27;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;kill -9:&quot;</span> <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h4 id="Post-Steps"><a href="#Post-Steps" class="headerlink" title="Post Steps"></a>Post Steps</h4><p>启动新项目</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /var/<span class="built_in">log</span>/netop/</span><br><span class="line">rm -rf /var/<span class="built_in">log</span>/netop/*</span><br><span class="line"><span class="built_in">cd</span> /var/lib/jenkins/workspace/NETOP</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-register/target/netop-register.jar  --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/register.log 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 60s</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-gateway/target/netop-gateway.jar   --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/gateway.log 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 60s</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-auth/target/netop-auth.jar   --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/auth.log 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 60s</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-upms/netop-upms-biz/target/netop-upms-biz.jar   --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/upms-biz.log 2&gt;&amp;1 &amp;</span><br><span class="line">sleep 60s</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-visual/netop-coveroptim/target/netop-coveroptim.jar   --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/coveroptim.log 2&gt;&amp;1 &amp;</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-visual/netop-map/target/netop-map.jar   --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/map.log 2&gt;&amp;1 &amp;</span><br><span class="line">BUILD_ID=dontKillMe nohup java -jar netop-visual/netop-config/target/netop-config.jar  --spring.profiles.active=dev &gt; /var/<span class="built_in">log</span>/netop/config.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h3 id="JENKINS部署NodeJs项目"><a href="#JENKINS部署NodeJs项目" class="headerlink" title="JENKINS部署NodeJs项目"></a>JENKINS部署NodeJs项目</h3><p><code>新建任务</code> -&gt; <code>构建一个自由风格的软件项目</code></p>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><p><img src="/2020/02/15/%E6%96%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BAJenkins/Jenkins_NODEJS.png" alt="image-20200215165550706"></p>
<h4 id="停止旧应用"><a href="#停止旧应用" class="headerlink" title="停止旧应用"></a>停止旧应用</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pid=`ps -ef | grep -n <span class="string">&#x27;NETOP_UI\/node_modules\/\.bin/vue-cli-service serve&#x27;</span> | grep -v grep | awk <span class="string">&#x27;&#123;print $2&#125;&#x27;</span>`</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -n <span class="string">&quot;<span class="variable">$pid</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;kill -9:&quot;</span> <span class="variable">$pid</span></span><br><span class="line">    <span class="built_in">kill</span> -9 <span class="variable">$pid</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h4 id="修改配置文件-1"><a href="#修改配置文件-1" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">oldIP=172.30.5.32</span><br><span class="line">newIP=172.30.4.203</span><br><span class="line">sed -i <span class="string">&#x27;s/&#x27;</span><span class="variable">$oldIP</span><span class="string">&#x27;/&#x27;</span><span class="variable">$newIP</span><span class="string">&#x27;/g&#x27;</span> `grep -rl <span class="variable">$oldIP</span> ./`</span><br><span class="line">sed -i <span class="string">&#x27;s/&#x27;</span>8080<span class="string">&#x27;/&#x27;</span>8888<span class="string">&#x27;/g&#x27;</span> vue.config.js</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm install -g cnpm --registry=https://registry.npm.taobao.org</span></span><br><span class="line">mkdir -p /var/<span class="built_in">log</span>/netop_ui/</span><br><span class="line">rm -rf /var/<span class="built_in">log</span>/netop_ui/*</span><br><span class="line"></span><br><span class="line">npm run pre</span><br><span class="line">BUILD_ID=dontKillMe nohup npm run dev &gt; /var/<span class="built_in">log</span>/netop_ui/dev.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<h2 id="日产运维"><a href="#日产运维" class="headerlink" title="日产运维"></a>日产运维</h2><h3 id="根据进程查询来源程序"><a href="#根据进程查询来源程序" class="headerlink" title="根据进程查询来源程序"></a>根据进程查询来源程序</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum -y install net-tools</span></span><br><span class="line">ps aux|grep nginx</span><br></pre></td></tr></table></figure>

<h3 id="根据端口号查询进程"><a href="#根据端口号查询进程" class="headerlink" title="根据端口号查询进程"></a>根据端口号查询进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunlp | grep 8080</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">NACOS实践</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-10 09:08:47" itemprop="dateCreated datePublished" datetime="2020-02-10T09:08:47+08:00">2020-02-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>25 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="注册中心的作用"><a href="#注册中心的作用" class="headerlink" title="注册中心的作用"></a>注册中心的作用</h2><h3 id="无注册中心的调用的缺点"><a href="#无注册中心的调用的缺点" class="headerlink" title="无注册中心的调用的缺点"></a>无注册中心的调用的缺点</h3><p>比如现在我的用户服务是占用(User服务)8081端口的服务, 此时我的服务提供方(order服务端口是8080)端口<br>我们可以通过<code>RestTemplate</code>调用方式来进行调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ResponseEntity&lt;ProductInfo&gt;   responseEntity=</span><br><span class="line">restTemplate.getForEntity(<span class="string">&quot;http://localhost:8081/selectProductInfoById/&quot;</span>+</span><br><span class="line">orderInfo.getProductNo(),ProductInfo.class);</span><br></pre></td></tr></table></figure>
<p>缺点:</p>
<ol>
<li>请求IP地址与端口为硬编码，如果服务提供方(order)服务部署的机器换了端口或者是更换了部署机器的Ip,那么需要修改代码重新发布部署。</li>
<li>不容易维护，当order服务作为集群时，运维人员 需要在服务消费方进行手工维护一份注册表(容易出错)。</li>
<li><code>NGINX</code>配置文件太复杂，当服务越来越多时，NGINX的配合文件越来越复杂<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316150526591.png" alt="image-20200316150526591"></li>
</ol>
<h3 id="服务注册发现原理"><a href="#服务注册发现原理" class="headerlink" title="服务注册发现原理"></a>服务注册发现原理</h3><h4 id="最简单的版本"><a href="#最简单的版本" class="headerlink" title="最简单的版本"></a>最简单的版本</h4><p>订单服务直接调用商品服务，</p>
<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316230759879.png" alt="image-20200316230759879"></p>
<h4 id="增加集群支持"><a href="#增加集群支持" class="headerlink" title="增加集群支持"></a>增加集群支持</h4><p>支持集群，将商品服务列表写入订单服务的内存</p>
<ul>
<li>需要手动写一个算法（轮询，随机，等）抽取一个IP进行调用</li>
<li>当其中一台机器挂掉之后，订单服务无法感知，依然会调用挂掉的机器。导致调用失败<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316231011729.png" alt="image-20200316231011729"></li>
</ul>
<h4 id="使用NGINX反向代理"><a href="#使用NGINX反向代理" class="headerlink" title="使用NGINX反向代理"></a>使用NGINX反向代理</h4><ul>
<li>商品服务由NGINX来维护</li>
<li>选择其中一个商品服务也有NGINX来实现</li>
<li>不健康的服务也可以由NGINX剔除</li>
</ul>
<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316232008563.png" alt="image-20200316232008563"></p>
<h4 id="NGINX处理集群时的问题"><a href="#NGINX处理集群时的问题" class="headerlink" title="NGINX处理集群时的问题"></a>NGINX处理集群时的问题</h4><ul>
<li>NGINX的配置文件过于复杂，不利于维护<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316232453452.png" alt="image-20200316232453452"></li>
</ul>
<h4 id="注册中心的引入"><a href="#注册中心的引入" class="headerlink" title="注册中心的引入"></a>注册中心的引入</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注册接口业务逻辑</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> server_register_table(<span class="keyword">id</span>,service_name,ip,port,<span class="keyword">status</span>) <span class="keyword">values</span>(?,?,?,?)</span><br><span class="line"><span class="comment">-- 服务发现接口业务逻辑</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> server_register_table <span class="keyword">where</span> service_name=<span class="string">&#x27;product-server&#x27;</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">status</span> = <span class="string">&#x27;up</span></span><br></pre></td></tr></table></figure>
<ol>
<li>订单服务启动的时候，调用注册接口主要逻辑就是insert</li>
<li>商品服务启动时候，调用注册接口主要逻辑就是insert</li>
<li>每次调用商品服务前，都去注册中心获取商品服务的ip主要逻辑select</li>
<li>根据第二步获取的ip进行远程调用</li>
</ol>
<p>存在的问题</p>
<ol>
<li>难道每次订单服务-&gt;商品都要去注册中心拉取服务ip么？</li>
<li>若我订单服务去注册中心拉取的商品服务的ip对应机器宕机了怎么办？</li>
<li>注册中心宕机了怎么办？</li>
</ol>
<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316232740608.png" alt="image-20200316232740608"></p>
<h4 id="注册中心优化"><a href="#注册中心优化" class="headerlink" title="注册中心优化"></a>注册中心优化</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 注册接口业务逻辑</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> server_register_table(<span class="keyword">id</span>,service_name,ip,port,<span class="keyword">status</span>) <span class="keyword">values</span>(?,?,?,?)</span><br><span class="line"><span class="comment">-- 服务发现接口业务逻辑</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> server_register_table <span class="keyword">where</span> service_name=<span class="string">&#x27;product-server&#x27;</span></span><br><span class="line"><span class="keyword">and</span> <span class="keyword">status</span> = <span class="string">&#x27;up&#x27;</span></span><br><span class="line"><span class="comment">-- 服务心跳接口业务逻辑</span></span><br><span class="line"><span class="keyword">update</span> server_register_table <span class="keyword">set</span> last_heartTime = <span class="keyword">current_time</span> <span class="keyword">where</span> service_name=<span class="string">&#x27;product-server&#x27;</span></span><br><span class="line"><span class="keyword">and</span> ip = <span class="string">&#x27;192.168.159.2&#x27;</span></span><br><span class="line"><span class="comment">-- 注销接口业务逻辑</span></span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> server_register_table <span class="keyword">where</span> service_name = <span class="string">&#x27;order-server&#x27;</span> <span class="keyword">and</span> ip=<span class="string">&#x27;192.169.158.1&#x27;</span></span><br><span class="line"><span class="comment">-- TaskTimer3的业务逻辑(假设剔除15s没有续约的服务)</span></span><br><span class="line"><span class="keyword">update</span> server_register_table <span class="keyword">set</span> <span class="keyword">status</span>=<span class="string">&#x27;down&#x27;</span> <span class="keyword">where</span> <span class="keyword">current_time</span>-last_heartTime&gt;<span class="number">15</span></span><br></pre></td></tr></table></figure>
<ol>
<li><code>订单服务</code>, <code>商品服务</code>启动的时候，调用注册中心的<code>注册接口</code>主要逻辑就是insert</li>
<li><code>订单服务</code>,<code>商品服务</code>都有一个<code>TimeTask1</code>,定时发送心跳到 注册中心的<code>心跳接口</code></li>
<li><code>订单服务</code>的<code>TimeTask2</code>定时拉取商品服务实例ip信息存储到客户端缓存</li>
<li><code>RIBBON</code>会在客户端缓存中选择一个<code>IP</code>进行远程调用</li>
<li>注册中心有一个定时任务<code>TaskTimer3</code>定时清理没有心跳的实例信息</li>
<li>当服务被停止时，调用注册中心的<code>注销接口</code>，删除这条记录。</li>
</ol>
<p><code>TimeTask1</code>的主要逻辑就是定时发送心跳修改注册中心的<code>last_hearTime</code>(最后一次心跳时间)<br><code>TimeTask2</code>的主要逻辑就是定时拉取状态为<code>up</code>的商品服务实例ip信息存储到客户端缓存<br><code>TaskTimer3</code>定时清理没有心跳的实例信息,剔除15s没有续约的服务,将该服务设置为down</p>
<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316233414947.png" alt="image-20200316233414947"></p>
<h4 id="简单实现（V1）"><a href="#简单实现（V1）" class="headerlink" title="简单实现（V1）"></a>简单实现（V1）</h4><ul>
<li>V1版本的架构，存在以下几个问题<ul>
<li>我们的微服务每次调用，都会去进行对数据库的查询，并发一高，数据库性能就是一个瓶颈问题.</li>
<li>若我们的mysql挂了，那么我们所有的微服务调用都不能正常进行。</li>
<li>若mysql是正常的,库存微服务挂了，那么也不能正常的调用<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316150853237.png" alt="image-20200316150853237"></li>
</ul>
</li>
</ul>
<h4 id="升级实现（V2）"><a href="#升级实现（V2）" class="headerlink" title="升级实现（V2）"></a>升级实现（V2）</h4><p>3个定时器</p>
<ul>
<li>客户端定时上报lastime到注册中心</li>
<li>客户端获取注册中心的服务到本地</li>
<li>注册中心定时清理长时间没有心跳的服务（标记为down）</li>
</ul>
<p>4个接口</p>
<ul>
<li>注册接口，服务启动时将信息（serverName,Ip，port，status,lat_heartiME） 上报给注册中心</li>
<li>心跳接口，客户端定时上报lastime到注册中心</li>
<li>微服务获取接口，定时拉取商品服务实例ip信息存到客户端缓存</li>
<li>注销接口，当服务注销时，删除注册中心里对应的记录–删除  ，长时间没有心跳是down<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200316151037691.png" alt="image-20200316151037691"></li>
</ul>
<h4 id><a href="#" class="headerlink" title></a></h4><h2 id="使用NACOS步骤"><a href="#使用NACOS步骤" class="headerlink" title="使用NACOS步骤"></a>使用NACOS步骤</h2><h3 id="三板斧之-第一板斧-加入依赖"><a href="#三板斧之-第一板斧-加入依赖" class="headerlink" title="三板斧之:第一板斧 加入依赖"></a>三板斧之:第一板斧 加入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring‐cloud‐alibaba‐nacos‐discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="三板斧之-第二板斧写注解-也可以不写-EnableDiscoveryClient"><a href="#三板斧之-第二板斧写注解-也可以不写-EnableDiscoveryClient" class="headerlink" title="三板斧之:第二板斧写注解(也可以不写) @EnableDiscoveryClient"></a>三板斧之:第二板斧写注解(也可以不写) <code>@EnableDiscoveryClient</code></h3><p>高版本中可以不写，应为有自动装配原理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tulingvip01MsAlibabaNacosClientOrderApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		SpringApplication.run(Tulingvip01MsAlibabaNacosClientOrderApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="第三板斧之-写配置文件-注意server-addr：不需要写协议"><a href="#第三板斧之-写配置文件-注意server-addr：不需要写协议" class="headerlink" title="第三板斧之:写配置文件 注意server-addr：不需要写协议"></a>第三板斧之:写配置文件 <strong>注意</strong>server-addr：不需要写协议</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">	<span class="attr">cloud:</span></span><br><span class="line">		<span class="attr">nacos:</span></span><br><span class="line">			<span class="attr">discovery:</span></span><br><span class="line">				<span class="string">server‐addr:</span> <span class="string">localhost:8848</span></span><br><span class="line">	<span class="attr">application:</span></span><br><span class="line">		<span class="attr">name:</span> <span class="string">order‐center</span></span><br></pre></td></tr></table></figure>
<h2 id="Nacos-领域模型划分以及概念详解"><a href="#Nacos-领域模型划分以及概念详解" class="headerlink" title="Nacos 领域模型划分以及概念详解"></a>Nacos 领域模型划分以及概念详解</h2><p>源码中会将服务以双层MAP的形式保存<code>Map&lt;nameSpaceId,Map&lt;group::serviceName,Service&gt;</code>，第二层<code>group::serviceName</code>是key的拼接风格，这说明了NACOS是支持跨集群调用的，如果要防止跨集群调用就需要自己筛选。<br>当然可以手动实现 v1版本的生产者 调用 v1版本的消费者<br><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200317001326646.png" alt="image-20200317001326646"></p>
<p>NACOS单机启动方式 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;startup.sh -m standalone</span><br></pre></td></tr></table></figure>


<p>NACOS集群启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;startup.sh</span><br></pre></td></tr></table></figure>





<p>第二期第一节可 看zone ,eureka应用入门 （亚马逊），没有zone相当于轮询</p>
<p>ribbon实现负载均衡算法用了模版设计模式，提高了代码的复用性</p>
<p>修改ribbon负载均衡策略</p>
<p>@Bean</p>
<p>public IRule randomRule(){</p>
<p>​    return new RandomRule();</p>
<p>}</p>
<p>为不同的服务定制不同的负载均衡策略</p>
<p>1， 制定两个不同的策略，这两个策略不可以被springboot扫描到，否则会变成全局策略</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.netflix.loadbalancer.RoundRobinRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class PayCenterRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public IRule roundRobinRule() &#123;</span><br><span class="line">        return new RoundRobinRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.netflix.loadbalancer.RandomRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class ProductCenterRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public IRule randomRule() &#123;</span><br><span class="line">        return new RandomRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * ribbon的全局配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">@RibbonClients(value &#x3D; &#123;</span><br><span class="line">        @RibbonClient(name &#x3D; &quot;product-center&quot;,configuration &#x3D; ProductCenterRibbonConfig.class),</span><br><span class="line">        @RibbonClient(name &#x3D; &quot;pay-center&quot;,configuration &#x3D; PayCenterRibbonConfig.class)</span><br><span class="line">&#125;)</span><br><span class="line">public class CustomRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法2，在yml中配置(推荐)，非常不推荐两个方法一起用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#自定义Ribbon的细粒度配置</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#ribbon:</span><br><span class="line">  #NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RandomRule #指定全局策略</span><br><span class="line">  #eager-load:</span><br><span class="line">    #enabled: true</span><br><span class="line">#product-center: # 指定服务策略</span><br><span class="line">  #ribbon:</span><br><span class="line">    #NFLoadBalancerRuleClassName: com.netflix.loadbalancer.RoundRobinRule</span><br><span class="line">    #eager-load:</span><br><span class="line">      #enabled: true</span><br></pre></td></tr></table></figure>



<p>ribbon参数d的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#ribbon:</span><br><span class="line">  #ReadTimeout: 1000  读取时间超时</span><br><span class="line">  #ConnectTimeout: 1000</span><br><span class="line">  #MaxAutoRetries: 1 重试同一台服务的次数（不包括第一台）</span><br><span class="line">  #MaxAutoRetriesNextServer: 2 重试列表中服务的次数(不包括第一台)</span><br><span class="line">  #OkToRetryOnAllOperations: false 是否限制http的方法，设置为true post，put会进行重试，要保证接口幂等性</span><br><span class="line">  #http:</span><br><span class="line">    #client:</span><br><span class="line">      #enabled: true</span><br></pre></td></tr></table></figure>


<p>Nacos有2大组件<br>    NamingService：服务发现中心，发HTTP请求，调用服务发现接口<br>    ConfigService：配置中心</p>
<p>在ribbon中实现权重算法<br>全局配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import com.ribbonconfig.GlobalRibbonConfig;</span><br><span class="line">import com.ribbonconfig.PayCenterRibbonConfig;</span><br><span class="line">import com.ribbonconfig.ProductCenterRibbonConfig;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClients;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * ribbon的全局配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RibbonClients(defaultConfiguration &#x3D; GlobalRibbonConfig.class)</span><br><span class="line"></span><br><span class="line">public class CustomRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>扫描器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityWithVersionRule;</span><br><span class="line">import com.tuling.myrule.TulingWeightedRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class GlobalRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public IRule theSameClusterPriorityRule() &#123;</span><br><span class="line">        return new TulingWeightedRule();</span><br><span class="line">        &#x2F;&#x2F;return new TheSameClusterPriorityRule();</span><br><span class="line">        &#x2F;&#x2F;return new TheSameClusterPriorityWithVersionRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具体实现,这里权重需要在nacos上配置，一般来说设置<code>0~1</code>,他是按照比例来计算的，所以设置大于1也可以。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.myrule;</span><br><span class="line"></span><br><span class="line">import com.alibaba.cloud.nacos.NacosDiscoveryProperties;</span><br><span class="line">import com.alibaba.cloud.nacos.ribbon.NacosServer;</span><br><span class="line">import com.alibaba.nacos.api.exception.NacosException;</span><br><span class="line">import com.alibaba.nacos.api.naming.NamingService;</span><br><span class="line">import com.alibaba.nacos.api.naming.pojo.Instance;</span><br><span class="line">import com.netflix.client.config.IClientConfig;</span><br><span class="line">import com.netflix.loadbalancer.AbstractLoadBalancerRule;</span><br><span class="line">import com.netflix.loadbalancer.BaseLoadBalancer;</span><br><span class="line">import com.netflix.loadbalancer.Server;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Slf4j</span><br><span class="line">public class TulingWeightedRule extends AbstractLoadBalancerRule &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private NacosDiscoveryProperties discoveryProperties;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initWithNiwsConfig(IClientConfig clientConfig) &#123;</span><br><span class="line">        &#x2F;&#x2F;读取配置文件并且初始化,ribbon内部的 几乎用不上</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Server choose(Object key) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            log.info(&quot;key:&#123;&#125;&quot;,key);</span><br><span class="line">            BaseLoadBalancer baseLoadBalancer &#x3D; (BaseLoadBalancer) this.getLoadBalancer();</span><br><span class="line">            log.info(&quot;baseLoadBalancer---&gt;:&#123;&#125;&quot;,baseLoadBalancer);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;获取微服务的名称</span><br><span class="line">            String serviceName &#x3D; baseLoadBalancer.getName();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;获取Nocas服务发现的相关组件API</span><br><span class="line">            NamingService namingService &#x3D;  discoveryProperties.namingServiceInstance();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;获取 一个基于nacos client 实现权重的负载均衡算法</span><br><span class="line">            Instance instance &#x3D; namingService.selectOneHealthyInstance(serviceName);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;返回一个server</span><br><span class="line">            return new NacosServer(instance);</span><br><span class="line">        &#125; catch (NacosException e) &#123;</span><br><span class="line">            log.error(&quot;自定义负载均衡算法错误&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同集群优先调用<br>在配置文件中指定自己的名称</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cloud:</span><br><span class="line">  nacos:</span><br><span class="line">    discovery:</span><br><span class="line">      server-addr: localhost:8848</span><br><span class="line">      cluster-name: NJ-CLUSTER # 指定自己集群的名称</span><br></pre></td></tr></table></figure>

<p>核心实现<br>从注册中心获取到所有的服务列表<br>从列表中查找与自己服务相同集群里列表，对这些列表进行负载均衡调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.myrule;</span><br><span class="line"></span><br><span class="line">import com.alibaba.cloud.nacos.NacosDiscoveryProperties;</span><br><span class="line">import com.alibaba.cloud.nacos.ribbon.NacosServer;</span><br><span class="line">import com.alibaba.nacos.api.exception.NacosException;</span><br><span class="line">import com.alibaba.nacos.api.naming.NamingService;</span><br><span class="line">import com.alibaba.nacos.api.naming.pojo.Instance;</span><br><span class="line">import com.alibaba.nacos.client.naming.core.Balancer;</span><br><span class="line">import com.netflix.client.config.IClientConfig;</span><br><span class="line">import com.netflix.loadbalancer.AbstractLoadBalancerRule;</span><br><span class="line">import com.netflix.loadbalancer.BaseLoadBalancer;</span><br><span class="line">import com.netflix.loadbalancer.Server;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 同一个集群优先调用策略</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;21.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Slf4j</span><br><span class="line">public class TheSameClusterPriorityRule extends AbstractLoadBalancerRule &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private NacosDiscoveryProperties discoveryProperties;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initWithNiwsConfig(IClientConfig clientConfig) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Server choose(Object key) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;第一步:获取当前服务所在的集群</span><br><span class="line">            String currentClusterName &#x3D; discoveryProperties.getClusterName();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第二步:获取一个负载均衡对象</span><br><span class="line">            BaseLoadBalancer baseLoadBalancer &#x3D; (BaseLoadBalancer) getLoadBalancer();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第三步:获取当前调用的微服务的名称</span><br><span class="line">            String invokedSerivceName &#x3D; baseLoadBalancer.getName();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第四步:获取nacos clinet的服务注册发现组件的api</span><br><span class="line">            NamingService namingService &#x3D; discoveryProperties.namingServiceInstance();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第五步:获取所有的服务实例</span><br><span class="line">            List&lt;Instance&gt; allInstance &#x3D;  namingService.getAllInstances(invokedSerivceName);</span><br><span class="line"></span><br><span class="line">            List&lt;Instance&gt; theSameClusterNameInstList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第六步:过滤筛选同集群下的所有实例</span><br><span class="line">            for(Instance instance : allInstance) &#123;</span><br><span class="line">                if(StringUtils.endsWithIgnoreCase(instance.getClusterName(),currentClusterName)) &#123;</span><br><span class="line">                    theSameClusterNameInstList.add(instance);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Instance toBeChooseInstance ;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;第七步:选择合适的一个实例调用</span><br><span class="line">            if(theSameClusterNameInstList.isEmpty()) &#123;</span><br><span class="line"></span><br><span class="line">                toBeChooseInstance &#x3D; TulingWeightedBalancer.chooseInstanceByRandomWeight(allInstance);</span><br><span class="line"></span><br><span class="line">                log.info(&quot;发生跨集群调用---&gt;当前微服务所在集群:&#123;&#125;,被调用微服务所在集群:&#123;&#125;,Host:&#123;&#125;,Port:&#123;&#125;&quot;,</span><br><span class="line">                        currentClusterName,toBeChooseInstance.getClusterName(),toBeChooseInstance.getIp(),toBeChooseInstance.getPort());</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                toBeChooseInstance &#x3D; TulingWeightedBalancer.chooseInstanceByRandomWeight(theSameClusterNameInstList);</span><br><span class="line"></span><br><span class="line">                log.info(&quot;同集群调用---&gt;当前微服务所在集群:&#123;&#125;,被调用微服务所在集群:&#123;&#125;,Host:&#123;&#125;,Port:&#123;&#125;&quot;,</span><br><span class="line">                        currentClusterName,toBeChooseInstance.getClusterName(),toBeChooseInstance.getIp(),toBeChooseInstance.getPort());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return new NacosServer(toBeChooseInstance);</span><br><span class="line"></span><br><span class="line">        &#125; catch (NacosException e) &#123;</span><br><span class="line">            log.error(&quot;同集群优先权重负载均衡算法选择异常:&#123;&#125;&quot;,e);</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>指定策略</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityWithVersionRule;</span><br><span class="line">import com.tuling.myrule.TulingWeightedRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class GlobalRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public IRule theSameClusterPriorityRule() &#123;</span><br><span class="line">        &#x2F;&#x2F;return new TulingWeightedRule();</span><br><span class="line">        return new TheSameClusterPriorityRule();</span><br><span class="line">        &#x2F;&#x2F;return new TheSameClusterPriorityWithVersionRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>全局配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import com.ribbonconfig.GlobalRibbonConfig;</span><br><span class="line">import com.ribbonconfig.PayCenterRibbonConfig;</span><br><span class="line">import com.ribbonconfig.ProductCenterRibbonConfig;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClients;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * ribbon的全局配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RibbonClients(defaultConfiguration &#x3D; GlobalRibbonConfig.class)</span><br><span class="line"></span><br><span class="line">public class CustomRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>权重算法，由Nacos客户端内部实现<br>这里有个小技巧：如果目标类的方法被<code>proteted</code>修饰可以用继承的方法，自定义一个<code>public</code>的方法调用它。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.myrule;</span><br><span class="line"></span><br><span class="line">import com.alibaba.nacos.api.naming.pojo.Instance;</span><br><span class="line">import com.alibaba.nacos.client.naming.core.Balancer;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据权重选择随机选择一个</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;21.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class TulingWeightedBalancer extends Balancer &#123;</span><br><span class="line">    &#x2F;&#x2F; getHostByRandomWeight 的修饰符是 protected 需要继承后包装一下再使用</span><br><span class="line">    public static Instance chooseInstanceByRandomWeight(List&lt;Instance&gt; hosts) &#123;</span><br><span class="line">        return getHostByRandomWeight(hosts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>金丝雀发布实现(同集群同版本直接调用)<br>修改配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cloud:</span><br><span class="line">  nacos:</span><br><span class="line">    discovery:</span><br><span class="line">      server-addr: localhost:8848</span><br><span class="line"></span><br><span class="line">      cluster-name: NJ-CLUSTER</span><br><span class="line">      metadata:	# metadata实际上是一个hashmap,里面的key-value可以随便指定</span><br><span class="line">        current-version: V1   # 指定版本号</span><br></pre></td></tr></table></figure>

<p>指定策略</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import com.netflix.loadbalancer.IRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityRule;</span><br><span class="line">import com.tuling.myrule.TheSameClusterPriorityWithVersionRule;</span><br><span class="line">import com.tuling.myrule.TulingWeightedRule;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;20.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Configuration</span><br><span class="line">public class GlobalRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public IRule theSameClusterPriorityRule() &#123;</span><br><span class="line">        return new TulingWeightedRule();</span><br><span class="line">        &#x2F;&#x2F;return new TheSameClusterPriorityRule();</span><br><span class="line">        &#x2F;&#x2F;return new TheSameClusterPriorityWithVersionRule();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>全局配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import com.ribbonconfig.GlobalRibbonConfig;</span><br><span class="line">import com.ribbonconfig.PayCenterRibbonConfig;</span><br><span class="line">import com.ribbonconfig.ProductCenterRibbonConfig;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line">import org.springframework.cloud.netflix.ribbon.RibbonClients;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">&#x2F;**</span><br><span class="line"> * ribbon的全局配置</span><br><span class="line"> *&#x2F;</span><br><span class="line">@RibbonClients(defaultConfiguration &#x3D; GlobalRibbonConfig.class)</span><br><span class="line"></span><br><span class="line">public class CustomRibbonConfig &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现核心</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.myrule;</span><br><span class="line"></span><br><span class="line">import com.alibaba.cloud.nacos.NacosDiscoveryProperties;</span><br><span class="line">import com.alibaba.cloud.nacos.ribbon.NacosServer;</span><br><span class="line">import com.alibaba.nacos.api.exception.NacosException;</span><br><span class="line">import com.alibaba.nacos.api.naming.NamingService;</span><br><span class="line">import com.alibaba.nacos.api.naming.pojo.Instance;</span><br><span class="line">import com.netflix.client.config.IClientConfig;</span><br><span class="line">import com.netflix.loadbalancer.AbstractLoadBalancerRule;</span><br><span class="line">import com.netflix.loadbalancer.BaseLoadBalancer;</span><br><span class="line">import com.netflix.loadbalancer.Server;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.util.StringUtils;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 金丝雀版本权重负载均衡策略</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;21.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Slf4j</span><br><span class="line">public class TheSameClusterPriorityWithVersionRule extends AbstractLoadBalancerRule &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private NacosDiscoveryProperties discoveryProperties;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initWithNiwsConfig(IClientConfig clientConfig) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Server choose(Object key) &#123;</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;获取本地所部署集群的名称 NJ-CLUSTER</span><br><span class="line">            String localClusterName &#x3D; discoveryProperties.getClusterName();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;去nacos上获取和本地 相同集群   相同版本的所有实例信息</span><br><span class="line">            List&lt;Instance&gt; theSameClusterNameAndTheSameVersionInstList &#x3D; getTheSameClusterAndTheSameVersionInstances(discoveryProperties);</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;声明被调用的实例</span><br><span class="line">            Instance toBeChooseInstance;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;判断同集群同版本号的微服务实例是否为空</span><br><span class="line">            if(theSameClusterNameAndTheSameVersionInstList.isEmpty()) &#123;</span><br><span class="line">                &#x2F;&#x2F;跨集群调用相同的版本</span><br><span class="line">                toBeChooseInstance &#x3D; crossClusterAndTheSameVersionInovke(discoveryProperties);</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">                &#x2F;&#x2F;具有同集群  同版本号的实例</span><br><span class="line">                toBeChooseInstance &#x3D; TulingWeightedBalancer.chooseInstanceByRandomWeight(theSameClusterNameAndTheSameVersionInstList);</span><br><span class="line">                log.info(&quot;同集群同版本调用---&gt;当前微服务所在集群:&#123;&#125;,被调用微服务所在集群:&#123;&#125;,当前微服务的版本:&#123;&#125;,被调用微服务版本:&#123;&#125;,Host:&#123;&#125;,Port:&#123;&#125;&quot;,</span><br><span class="line">                        localClusterName,toBeChooseInstance.getClusterName(),discoveryProperties.getMetadata().get(&quot;current-version&quot;),</span><br><span class="line">                        toBeChooseInstance.getMetadata().get(&quot;current-version&quot;),toBeChooseInstance.getIp(),toBeChooseInstance.getPort());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return new NacosServer(toBeChooseInstance);</span><br><span class="line"></span><br><span class="line">        &#125; catch (NacosException e) &#123;</span><br><span class="line">            log.error(&quot;同集群优先权重负载均衡算法选择异常:&#123;&#125;&quot;,e);</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 方法实现说明:获取相同集群下,相同版本的 所有实例</span><br><span class="line">     * @author:smlz</span><br><span class="line">     * @param discoveryProperties nacos的配置</span><br><span class="line">     * @return: List&lt;Instance&gt;</span><br><span class="line">     * @exception: NacosException</span><br><span class="line">     * @date:2019&#x2F;11&#x2F;21 16:41</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Instance&gt; getTheSameClusterAndTheSameVersionInstances(NacosDiscoveryProperties discoveryProperties) throws NacosException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;当前的集群的名称</span><br><span class="line">        String currentClusterName &#x3D; discoveryProperties.getClusterName();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;当前的版本号</span><br><span class="line">        String currentVersion &#x3D; discoveryProperties.getMetadata().get(&quot;current-version&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;获取所有实例的信息(包括不同集群的,不同版本号的)</span><br><span class="line">        List&lt;Instance&gt; allInstance &#x3D;  getAllInstances(discoveryProperties);</span><br><span class="line"></span><br><span class="line">        List&lt;Instance&gt; theSameClusterNameAndTheSameVersionInstList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;过滤相同集群  同版本号的实例</span><br><span class="line">        for(Instance instance : allInstance) &#123;</span><br><span class="line">            if(StringUtils.endsWithIgnoreCase(instance.getClusterName(),currentClusterName)&amp;&amp;</span><br><span class="line">               StringUtils.endsWithIgnoreCase(instance.getMetadata().get(&quot;current-version&quot;),currentVersion)) &#123;</span><br><span class="line"></span><br><span class="line">                theSameClusterNameAndTheSameVersionInstList.add(instance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return theSameClusterNameAndTheSameVersionInstList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 方法实现说明:获取被调用服务的所有实例</span><br><span class="line">     * @author:smlz</span><br><span class="line">     * @param discoveryProperties nacos的配置</span><br><span class="line">     * @return: List&lt;Instance&gt;</span><br><span class="line">     * @exception: NacosException</span><br><span class="line">     * @date:2019&#x2F;11&#x2F;21 16:42</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Instance&gt; getAllInstances(NacosDiscoveryProperties discoveryProperties) throws NacosException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;第1步:获取一个负载均衡对象</span><br><span class="line">        BaseLoadBalancer baseLoadBalancer &#x3D; (BaseLoadBalancer) getLoadBalancer();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;第2步:获取当前调用的微服务的名称</span><br><span class="line">        String invokedSerivceName &#x3D; baseLoadBalancer.getName();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;第3步:获取nacos clinet的服务注册发现组件的api</span><br><span class="line">        NamingService namingService &#x3D; discoveryProperties.namingServiceInstance();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;第4步:获取所有的服务实例</span><br><span class="line">        List&lt;Instance&gt; allInstance &#x3D;  namingService.getAllInstances(invokedSerivceName);</span><br><span class="line"></span><br><span class="line">        return allInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 方法实现说明:跨集群环境下 相同版本的</span><br><span class="line">     * @author:smlz</span><br><span class="line">     * @param discoveryProperties</span><br><span class="line">     * @return: List&lt;Instance&gt;</span><br><span class="line">     * @exception: NacosException</span><br><span class="line">     * @date:2019&#x2F;11&#x2F;21 17:11</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private List&lt;Instance&gt; getCrossClusterAndTheSameVersionInstList(NacosDiscoveryProperties discoveryProperties) throws NacosException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;版本号</span><br><span class="line">        String currentVersion &#x3D; discoveryProperties.getMetadata().get(&quot;current-version&quot;);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;被调用的所有实例</span><br><span class="line">        List&lt;Instance&gt; allInstance &#x3D; getAllInstances(discoveryProperties);</span><br><span class="line"></span><br><span class="line">        List&lt;Instance&gt;  crossClusterAndTheSameVersionInstList &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;过滤相同版本</span><br><span class="line">        for(Instance instance : allInstance) &#123;</span><br><span class="line">            if(StringUtils.endsWithIgnoreCase(instance.getMetadata().get(&quot;current-version&quot;),currentVersion)) &#123;</span><br><span class="line"></span><br><span class="line">                crossClusterAndTheSameVersionInstList.add(instance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return crossClusterAndTheSameVersionInstList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private Instance crossClusterAndTheSameVersionInovke(NacosDiscoveryProperties discoveryProperties) throws NacosException &#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;获取所有集群下相同版本的实例信息</span><br><span class="line">        List&lt;Instance&gt;  crossClusterAndTheSameVersionInstList &#x3D; getCrossClusterAndTheSameVersionInstList(discoveryProperties);</span><br><span class="line">        &#x2F;&#x2F;当前微服务的版本号</span><br><span class="line">        String currentVersion &#x3D; discoveryProperties.getMetadata().get(&quot;current-version&quot;);</span><br><span class="line">        &#x2F;&#x2F;当前微服务的集群名称</span><br><span class="line">        String currentClusterName &#x3D; discoveryProperties.getClusterName();</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;声明被调用的实例</span><br><span class="line">        Instance toBeChooseInstance &#x3D; null ;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;没有对应相同版本的实例</span><br><span class="line">        if(crossClusterAndTheSameVersionInstList.isEmpty()) &#123;</span><br><span class="line">            log.info(&quot;跨集群调用找不到对应合适的版本当前版本为:currentVersion:&#123;&#125;&quot;,currentVersion);</span><br><span class="line">            throw new RuntimeException(&quot;找不到相同版本的微服务实例&quot;);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            toBeChooseInstance &#x3D; TulingWeightedBalancer.chooseInstanceByRandomWeight(crossClusterAndTheSameVersionInstList);</span><br><span class="line"></span><br><span class="line">            log.info(&quot;跨集群同版本调用---&gt;当前微服务所在集群:&#123;&#125;,被调用微服务所在集群:&#123;&#125;,当前微服务的版本:&#123;&#125;,被调用微服务版本:&#123;&#125;,Host:&#123;&#125;,Port:&#123;&#125;&quot;,</span><br><span class="line">                    currentClusterName,toBeChooseInstance.getClusterName(),discoveryProperties.getMetadata().get(&quot;current-version&quot;),</span><br><span class="line">                    toBeChooseInstance.getMetadata().get(&quot;current-version&quot;),toBeChooseInstance.getIp(),toBeChooseInstance.getPort());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return toBeChooseInstance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>启动时通过<code>RestTemplate</code>调用远程服务会调用失败</p>
<p>拦截器代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.intercept;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.InitializingBean;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.client.RestTemplate;</span><br><span class="line">import org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2020&#x2F;2&#x2F;7.</span><br><span class="line"> *&#x2F;</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">public class AuthIntercept implements HandlerInterceptor,InitializingBean &#123;</span><br><span class="line"></span><br><span class="line">    private static final String KEY_URL &#x3D; &quot;http:&#x2F;&#x2F;product-center&#x2F;getKey&quot; ;</span><br><span class="line"></span><br><span class="line">    private String securetKey ;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line"></span><br><span class="line">        log.info(&quot;通过密钥校验token:&#123;&#125;&quot;,securetKey);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">	&#x2F;&#x2F; InitializingBean接口 这里会在初始化的时候执行</span><br><span class="line">    @Override</span><br><span class="line">    public void afterPropertiesSet() throws Exception &#123;</span><br><span class="line">        securetKey &#x3D; restTemplate.postForObject(KEY_URL,null,String.class);</span><br><span class="line">        log.info(&quot;获取的Key:&#123;&#125;&quot;,securetKey);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<p>被@loadBalance注解 会在LoadBalancerAutoConfiguration类中 定制拦截器也就是 loadBalancedRestTemplateInitializerDeprecated()方法</p>
<p>RestTemplate里面会注入一个LoaderBalanceClient，LoadBalancerAutoConfiguration类的restTemplateCustomizer方法会把拦截器（LoaderBalanceClient）塞入resttemplate中</p>
<p>因为RestTemplate在会在 SmartInitializingSingleton的 afterSingletonsInstantiated方法 去装载拦截器（78多行）</p>
<p>但是 InitializingBean接口会在  DefaultListableBeanFactory.java的 getBean()方法执行 （769行）</p>
<p>也就是说在执行拦截器时，restTemplate还没有拦截器，无法起到负载均衡的作用</p>
<p>解决方法就是重写RestTemplate</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">package com.tuling.config;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.cloud.client.ServiceInstance;</span><br><span class="line">import org.springframework.cloud.client.discovery.DiscoveryClient;</span><br><span class="line">import org.springframework.http.HttpMethod;</span><br><span class="line">import org.springframework.http.client.ClientHttpRequest;</span><br><span class="line">import org.springframework.http.client.ClientHttpResponse;</span><br><span class="line">import org.springframework.lang.Nullable;</span><br><span class="line">import org.springframework.util.Assert;</span><br><span class="line">import org.springframework.web.client.*;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.net.URI;</span><br><span class="line">import java.net.URISyntaxException;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Random;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 根据RestTemplate特性自己改造</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;19.</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Slf4j</span><br><span class="line">public class TulingRestTemplate extends RestTemplate &#123;</span><br><span class="line"></span><br><span class="line">    private DiscoveryClient discoveryClient;</span><br><span class="line"></span><br><span class="line">    public TulingRestTemplate (DiscoveryClient discoveryClient) &#123;</span><br><span class="line">        this.discoveryClient &#x3D; discoveryClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected &lt;T&gt; T doExecute(URI url, @Nullable HttpMethod method, @Nullable RequestCallback requestCallback,</span><br><span class="line">                              @Nullable ResponseExtractor&lt;T&gt; responseExtractor) throws RestClientException &#123;</span><br><span class="line"></span><br><span class="line">        Assert.notNull(url, &quot;URI is required&quot;);</span><br><span class="line">        Assert.notNull(method, &quot;HttpMethod is required&quot;);</span><br><span class="line">        ClientHttpResponse response &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line"></span><br><span class="line">            log.info(&quot;请求的url路径为:&#123;&#125;&quot;,url);</span><br><span class="line">            &#x2F;&#x2F;把服务名 替换成我们的IP</span><br><span class="line">            url &#x3D; replaceUrl(url);</span><br><span class="line"></span><br><span class="line">            log.info(&quot;替换后的路径:&#123;&#125;&quot;,url);</span><br><span class="line"></span><br><span class="line">            ClientHttpRequest request &#x3D; createRequest(url, method);</span><br><span class="line">            if (requestCallback !&#x3D; null) &#123;</span><br><span class="line">                requestCallback.doWithRequest(request);</span><br><span class="line">            &#125;</span><br><span class="line">            response &#x3D; request.execute();</span><br><span class="line">            handleResponse(url, method, response);</span><br><span class="line">            return (responseExtractor !&#x3D; null ? responseExtractor.extractData(response) : null);</span><br><span class="line">        &#125;</span><br><span class="line">        catch (IOException ex) &#123;</span><br><span class="line">            String resource &#x3D; url.toString();</span><br><span class="line">            String query &#x3D; url.getRawQuery();</span><br><span class="line">            resource &#x3D; (query !&#x3D; null ? resource.substring(0, resource.indexOf(&#39;?&#39;)) : resource);</span><br><span class="line">            throw new ResourceAccessException(&quot;I&#x2F;O error on &quot; + method.name() +</span><br><span class="line">                    &quot; request for \&quot;&quot; + resource + &quot;\&quot;: &quot; + ex.getMessage(), ex);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (response !&#x3D; null) &#123;</span><br><span class="line">                response.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 方法实现说明:把微服务名称  去注册中心拉取对应IP进行调用</span><br><span class="line">     * http:&#x2F;&#x2F;product-center&#x2F;selectProductInfoById&#x2F;1</span><br><span class="line">     * @author:smlz</span><br><span class="line">     * @param url:请求的url</span><br><span class="line">     * @return:</span><br><span class="line">     * @exception:</span><br><span class="line">     * @date:2020&#x2F;2&#x2F;6 13:11</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private URI replaceUrl(URI url)&#123;</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;1:从URI中解析调用的调用的serviceName&#x3D;product-center</span><br><span class="line">        String serviceName &#x3D; url.getHost();</span><br><span class="line">        log.info(&quot;调用微服务的名称:&#123;&#125;&quot;,serviceName);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;2:解析我们的请求路径 reqPath&#x3D; &#x2F;selectProductInfoById&#x2F;1</span><br><span class="line">        String reqPath &#x3D; url.getPath();</span><br><span class="line">        log.info(&quot;请求path:&#123;&#125;&quot;,reqPath);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;通过微服务的名称去nacos服务端获取 对应的实例列表</span><br><span class="line">        List&lt;ServiceInstance&gt; serviceInstanceList &#x3D; discoveryClient.getInstances(serviceName);</span><br><span class="line">        if(serviceInstanceList.isEmpty()) &#123;</span><br><span class="line">            throw new RuntimeException(&quot;没有可用的微服务实例列表:&quot;+serviceName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String serviceIp &#x3D; chooseTargetIp(serviceInstanceList);</span><br><span class="line"></span><br><span class="line">        String source &#x3D; serviceIp+reqPath;</span><br><span class="line">        try &#123;</span><br><span class="line">            return new URI(source);</span><br><span class="line">        &#125; catch (URISyntaxException e) &#123;</span><br><span class="line">            log.error(&quot;根据source:&#123;&#125;构建URI异常&quot;,source);</span><br><span class="line">        &#125;</span><br><span class="line">        return url;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 方法实现说明:从服务列表中 随机选举一个ip</span><br><span class="line">     * @author:smlz</span><br><span class="line">     * @param serviceInstanceList 服务列表</span><br><span class="line">     * @return: 调用的ip</span><br><span class="line">     * @exception:</span><br><span class="line">     * @date:2020&#x2F;2&#x2F;6 13:15</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String chooseTargetIp(List&lt;ServiceInstance&gt; serviceInstanceList) &#123;</span><br><span class="line">        &#x2F;&#x2F;采取随机的获取一个</span><br><span class="line">        Random random &#x3D; new Random();</span><br><span class="line">        Integer randomIndex &#x3D; random.nextInt(serviceInstanceList.size());</span><br><span class="line">        String serviceIp &#x3D; serviceInstanceList.get(randomIndex).getUri().toString();</span><br><span class="line">        log.info(&quot;随机选举的服务IP:&#123;&#125;&quot;,serviceIp);</span><br><span class="line">        return serviceIp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200319001432578.png" alt="image-20200319001432578"></p>
<p><img src="/2020/02/10/NACOS%E5%AE%9E%E8%B7%B5/image-20200319004051350.png" alt="image-20200319004051350"></p>
<p>Spring整合mybatis 与 整合Feign的套路是一样的</p>
<p>写在使用者的主类上@EnableFeignClients</p>
<p>写在api上@FeignClient(name=”product-center”)</p>
<p>复制实现类的注解与方法到api</p>
<p>定义feign的配置类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@FeignClient(name &#x3D; &quot;pay-center&quot;,configuration &#x3D; PayCenterFeignConfig.class)</span><br></pre></td></tr></table></figure>



<p>yml中必须制定feign-api的包为debug（控制是否答应）</p>
<p>在Config类中是控制打印多少日志（生产上一般用BASIC）</p>
<p>restttemplate中 传递token</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * Created by smlz on 2019&#x2F;11&#x2F;22.</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class TulingRequestInterceptor implements RequestInterceptor &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void apply(RequestTemplate template) &#123;</span><br><span class="line"></span><br><span class="line">        ServletRequestAttributes attributes &#x3D; (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request &#x3D; attributes.getRequest();</span><br><span class="line">        template.header(&quot;Token&quot;,request.getHeader(&quot;Token&quot;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置类中注入bean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public RequestInterceptor requestInterceptor() &#123;</span><br><span class="line">    return new TulingRequestInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生产环境中<br>调整日志级别<br>feigin调用改成httpclient</p>
<p>配置中心</p>
<p>bootstrap.yml优先于application.yml<br>配置文件名称规则 spring.application.name-spring.profiles.active . file-extension</p>
<p>启动时会加载配置文件顺序， config-app-dev.yml优先级最高</p>
<p>如果要实现动态刷新必须在类上标注 @RefreshScope</p>
<p>nacos默认是使用derby数据库，找到nacos目录/data/derby-data （要停止nacos）<br>用户名密码：<br>MAVEN:<br>org.springframework.cloud<br>spring-cloud-starter-seurity<br>1.2.2.RELEASE</p>
<p>new BCryptPasswordEncoder().encode(“nacos”) //结果就是加密后字符串</p>
<p>看spring源码最第一步就是看包下面的<code>spring.factories</code>文件 EnableAutoConfiguration对应的看一下</p>
<p>跳过分支代码（if + return）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/09/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/09/%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">测试工具</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-09 23:46:59" itemprop="dateCreated datePublished" datetime="2020-02-09T23:46:59+08:00">2020-02-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>410</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="MOCK工具"><a href="#MOCK工具" class="headerlink" title="MOCK工具"></a>MOCK工具</h2><h3 id="moco"><a href="#moco" class="headerlink" title="moco"></a>moco</h3><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RyZWFtaGVhZC9tb2Nv" title="https://github.com/dreamhead/moco">https://github.com/dreamhead/moco<i class="fa fa-external-link"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vdGFuZ3FpdS9wLzk0OTMxNDcuaHRtbA==" title="https://www.cnblogs.com/tangqiu/p/9493147.html">https://www.cnblogs.com/tangqiu/p/9493147.html<i class="fa fa-external-link"></i></span></p>
<h3 id="wiremock"><a href="#wiremock" class="headerlink" title="wiremock"></a>wiremock</h3><p><span class="exturl" data-url="aHR0cDovL3dpcmVtb2NrLm9yZy8=" title="http://wiremock.org/">http://wiremock.org/<i class="fa fa-external-link"></i></span></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><h3 id="postman"><a href="#postman" class="headerlink" title="postman"></a>postman</h3><h3 id="jmeter"><a href="#jmeter" class="headerlink" title="jmeter"></a>jmeter</h3><h3 id="Wireshar"><a href="#Wireshar" class="headerlink" title="Wireshar"></a>Wireshar</h3><h3 id="postwoman"><a href="#postwoman" class="headerlink" title="postwoman"></a>postwoman</h3><h3 id="Charles"><a href="#Charles" class="headerlink" title="Charles"></a>Charles</h3><h3 id="Talend-API-Tester"><a href="#Talend-API-Tester" class="headerlink" title="Talend API Tester"></a>Talend API Tester</h3><p>chrome 插件</p>
<h2 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h2><h3 id="ab"><a href="#ab" class="headerlink" title="ab"></a>ab</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYXBhY2hlbG91bmdlLmNvbS9kb3dubG9hZC8=" title="https://www.apachelounge.com/download/">https://www.apachelounge.com/download/<i class="fa fa-external-link"></i></span><br>httpd里面带有工具ab</p>
<h3 id="hey-Boom"><a href="#hey-Boom" class="headerlink" title="hey(Boom)"></a>hey(Boom)</h3><p>Boom是一个用Go语言实现的压力测试工具，就是和Apache Bench类似的工具。它提供了一个很有意思的UI，这就是我为什么推荐他的原因了：</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Jha3lsbC9ib29t" title="https://github.com/rakyll/boom">https://github.com/rakyll/boom<i class="fa fa-external-link"></i></span><br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Jha3lsbC9oZXk=" title="https://github.com/rakyll/hey">https://github.com/rakyll/hey<i class="fa fa-external-link"></i></span></p>
<h2 id="契约测试"><a href="#契约测试" class="headerlink" title="契约测试"></a>契约测试</h2><h3 id="Pact"><a href="#Pact" class="headerlink" title="Pact"></a>Pact</h3><h3 id="EOLINKER-API-Studio"><a href="#EOLINKER-API-Studio" class="headerlink" title="EOLINKER API Studio"></a>EOLINKER API Studio</h3><h2 id="运维工具"><a href="#运维工具" class="headerlink" title="运维工具"></a>运维工具</h2><h3 id="Fabric"><a href="#Fabric" class="headerlink" title="Fabric"></a>Fabric</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/08/Springboot%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/08/Springboot%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90/" class="post-title-link" itemprop="url">Springboot启动完成</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-08 22:17:15" itemprop="dateCreated datePublished" datetime="2020-02-08T22:17:15+08:00">2020-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>我们在使用SpringBoot搭建项目的时候，如果希望在项目启动完成之前(之后)，能够初始化一些操作。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/08/Springboot%E5%90%AF%E5%8A%A8%E5%AE%8C%E6%88%90/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/08/Springboot-%E4%BC%98%E9%9B%85%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/08/Springboot-%E4%BC%98%E9%9B%85%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Springboot 优雅停止服务的几种方法</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-08 15:35:33" itemprop="dateCreated datePublished" datetime="2020-02-08T15:35:33+08:00">2020-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在使用 SpringBoot 的时候，都要涉及到服务的停止和启动，当我们停止服务的时候，很多时候大家都是kill -9 直接把程序进程杀掉，这样程序不会执行优雅的关闭。而且一些没有执行完的程序就会直接退出。</p>
<p>我们很多时候都需要安全的将服务停止，也就是把没有处理完的工作继续处理完成。比如停止一些依赖的服务，输出一些日志，发一些信号给其他的应用系统，这个在保证系统的高可用是非常有必要的。那么咱么就来看一下几种停止 SpringBoot 的方法。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/02/08/Springboot-%E4%BC%98%E9%9B%85%E5%81%9C%E6%AD%A2%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/08/%E5%8D%81%E4%B8%AA%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%84JVM-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/08/%E5%8D%81%E4%B8%AA%E6%9C%80%E5%B8%B8%E7%94%A8%E7%9A%84JVM-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0/" class="post-title-link" itemprop="url">十个最常用的JVM 配置参数</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-08 09:51:04" itemprop="dateCreated datePublished" datetime="2020-02-08T09:51:04+08:00">2020-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>627</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Xms"><a href="#Xms" class="headerlink" title="-Xms"></a>-Xms</h2><p>初始堆大小。只要启动，就占用的堆大小。</p>
<h2 id="Xmx"><a href="#Xmx" class="headerlink" title="-Xmx"></a>-Xmx</h2><p>最大堆大小。java.lang.OutOfMemoryError：Java heap这个错误可以通过配置-Xms和-Xmx参数来设置。</p>
<h2 id="Xss"><a href="#Xss" class="headerlink" title="-Xss"></a>-Xss</h2><p>栈大小分配。栈是每个线程私有的区域，通常只有几百K大小，决定了函数调用的深度，而局部变量、参数都分配到栈上。</p>
<p>当出现大量局部变量，递归时，会发生栈空间OOM（java.lang.StackOverflowError）之类的错误。</p>
<h2 id="XX-NewSize"><a href="#XX-NewSize" class="headerlink" title="-XX:NewSize"></a>-XX:NewSize</h2><p>设置新生代大小的绝对值。</p>
<h2 id="XX-NewRatio"><a href="#XX-NewRatio" class="headerlink" title="-XX:NewRatio"></a>-XX:NewRatio</h2><p>设置年轻代和年老代的比值。比如设置为3，则新生代：老年代=1:3，新生代占总heap的1/4。</p>
<h2 id="XX-MaxPermSize"><a href="#XX-MaxPermSize" class="headerlink" title="-XX:MaxPermSize"></a>-XX:MaxPermSize</h2><p>设置持久代大小。</p>
<p>java.lang.OutOfMemoryError:PermGenspace这个OOM错误需要合理调大PermSize和MaxPermSize大小。</p>
<h2 id="XX-SurvivorRatio"><a href="#XX-SurvivorRatio" class="headerlink" title="-XX:SurvivorRatio"></a>-XX:SurvivorRatio</h2><p>年轻代中Eden区与两个Survivor区的比值。注意，Survivor区有form和to两个。比如设置为8时，那么eden:form:to=8:1:1。</p>
<h2 id="XX-HeapDumpOnOutOfMemoryError"><a href="#XX-HeapDumpOnOutOfMemoryError" class="headerlink" title="-XX:HeapDumpOnOutOfMemoryError"></a>-XX:HeapDumpOnOutOfMemoryError</h2><p>发生OOM时转储堆到文件，这是一个非常好的诊断方法。</p>
<h2 id="XX-HeapDumpPath"><a href="#XX-HeapDumpPath" class="headerlink" title="-XX:HeapDumpPath"></a>-XX:HeapDumpPath</h2><p>导出堆的转储文件路径。</p>
<h2 id="XX-OnOutOfMemoryError"><a href="#XX-OnOutOfMemoryError" class="headerlink" title="-XX:OnOutOfMemoryError"></a>-XX:OnOutOfMemoryError</h2><p>OOM时，执行一个脚本，比如发送邮件报警，重启程序。后面跟着一个脚本的路径。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/06/HEXO-DOCKER/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/HEXO-DOCKER/" class="post-title-link" itemprop="url">HEXO DOCKER</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-06 10:16:18" itemprop="dateCreated datePublished" datetime="2020-02-06T10:16:18+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>190</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo docker create --name=hexo-domain.com \</span><br><span class="line">-e HEXO_SERVER_PORT=4000 \</span><br><span class="line">-e GIT_USER=<span class="string">&quot;Your Name&quot;</span> \</span><br><span class="line">-e GIT_EMAIL=<span class="string">&quot;your.email@domain.tld&quot;</span> \</span><br><span class="line">-v /mnt/e/hexo:/app \</span><br><span class="line">-p 4000:4000 \</span><br><span class="line">spurin/hexo</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://127.0.0.1:4000/2020/02/06/WIN10%E5%AE%89%E8%A3%85DOCKER/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="XWookey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="咖喱鸡扒饭">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/02/06/WIN10%E5%AE%89%E8%A3%85DOCKER/" class="post-title-link" itemprop="url">WIN10安装DOCKER</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-02-06 10:12:31" itemprop="dateCreated datePublished" datetime="2020-02-06T10:12:31+08:00">2020-02-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-04 21:08:29" itemprop="dateModified" datetime="2020-11-04T21:08:29+08:00">2020-11-04</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="安装ubuntu"><a href="#安装ubuntu" class="headerlink" title="安装ubuntu"></a>安装ubuntu</h2><h2 id="解决vi命令方向键不可用，发出嘟嘟的声音，且提示E388-Couldn’t-find-definition"><a href="#解决vi命令方向键不可用，发出嘟嘟的声音，且提示E388-Couldn’t-find-definition" class="headerlink" title="解决vi命令方向键不可用，发出嘟嘟的声音，且提示E388:Couldn’t find definition"></a>解决vi命令方向键不可用，发出嘟嘟的声音，且提示E388:Couldn’t find definition</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~&#x2F;.vimrc</span><br><span class="line">:set term&#x3D;builtin_ansi</span><br></pre></td></tr></table></figure>

<h2 id="配置便捷"><a href="#配置便捷" class="headerlink" title="配置便捷"></a>配置便捷</h2><p>因为在 WSL 中 window 的盘符都是挂载在 /mnt 下的，所以设置 alias 有助于你快速的访问 window 目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo vim ~&#x2F;.bashrc</span><br><span class="line"></span><br><span class="line">alias cdc&#x3D;&#39;cd &#x2F;mnt&#x2F;c&#x2F;&#39;</span><br><span class="line">alias cdd&#x3D;&#39;cd &#x2F;mnt&#x2F;d&#x2F;&#39;</span><br><span class="line">alias cde&#x3D;&#39;cd &#x2F;mnt&#x2F;e&#x2F;&#39;</span><br></pre></td></tr></table></figure>


<h2 id="更新阿里源"><a href="#更新阿里源" class="headerlink" title="更新阿里源"></a>更新阿里源</h2><blockquote>
<p><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYWxpeXVuLmNvbS9taXJyb3IvdWJ1bnR1P3NwbT1hMmM2aC4xMzY1MTEwMi4wLjAuM2UyMjFiMTFScFVQVHY=" title="https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11RpUPTv">https://developer.aliyun.com/mirror/ubuntu?spm=a2c6h.13651102.0.0.3e221b11RpUPTv<i class="fa fa-external-link"></i></span></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak</span><br><span class="line">sudo vim /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ubuntu 18.04(bionic) 配置如下</span></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line"></span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>
<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"><span class="comment"># step 1: 安装必要的一些系统工具</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="comment"># step 2: 安装GPG证书</span></span><br><span class="line">curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># Step 3: 写入软件源信息</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu <span class="subst">$(lsb_release -cs)</span> stable&quot;</span></span><br><span class="line"><span class="comment"># Step 4: 更新并安装 Docker-CE</span></span><br><span class="line">sudo apt-get -y update</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Step 4:  显示稳定可使用版本</span></span><br><span class="line">apt-cache madison docker-ce</span><br><span class="line"><span class="comment"># Step 5:  安装稳定版本 这里需要不断的尝试 ： （ 卸载apt-get autoremove docker-ce）</span></span><br><span class="line">sudo apt-get install docker-ce=18.03.1~ce~3-0~ubuntu</span><br><span class="line"><span class="comment"># Step 6: 开启Docker服务</span></span><br><span class="line">sudo service docker start</span><br></pre></td></tr></table></figure>
<h2 id="加速镜像"><a href="#加速镜像" class="headerlink" title="加速镜像"></a>加速镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://md4nbj2f.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure>
<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Step 7: 验证</span></span><br><span class="line">sudo docker run -it --rm -p 8888:8080 tomcat:9.0</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="XWookey"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">XWookey</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">104</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">44</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1hXb29rZXk=" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;XWookey"><i class="fa fa-fw fa-github"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjE0ODM3OTkyOTlAcXEuY29t" title="E-Mail → mailto:1483799299@qq.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-rss"></i>RSS</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cDovL3d3dy5iYWlkdS5jb20=" title="http:&#x2F;&#x2F;www.baidu.com">百度一下</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly93d3cuZG91eXUuY29tLw==" title="https:&#x2F;&#x2F;www.douyu.com&#x2F;">斗鱼直播</span>
        </li>
        <li class="links-of-blogroll-item">
          <span class="exturl" data-url="aHR0cHM6Ly93d3cucHJvY2Vzc29uLmNvbS8=" title="https:&#x2F;&#x2F;www.processon.com&#x2F;">ProcessOn</span>
        </li>
    </ul>
  </div>

      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XWookey</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">361k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:28</span>
</div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/pjax/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/fancybox@3/dist/js/jquery.fancybox.pack.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      script.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  


    </div>
</body>
</html>
